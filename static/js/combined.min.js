function Helper(){this.getVerdictDescription=getVerdictDescription,this.getVerdictColor=getVerdictColor,this.toCamelCase=toCamelCase,this.getPageArr=getPageArr,this.parseToHTML=parseToHTML,this.setCookie=setCookie,this.getCookie=getCookie,this.deleteCookie=deleteCookie,this.isEmptyObject=isEmptyObject,this.generateRandomString=generateRandomString,this.getBrowseProblemByContestStructure=getBrowseProblemByContestStructure,this.sterilizeUsername=sterilizeUsername,this.colorList=colorList}function colorList(){return["#F44336","#9C27B0","#3f51B5","2196F3","#00BCD4","#009688","#4CAF50","#CDDC39","#FFC107","#FF9800","#795548","#9E9E9E","#607D8B"]}function sterilizeUsername(e){var t=e.indexOf("]");return-1!==t&&(e=e.substr(t+1)),e}function getVerdictColor(e){switch(e){case"Pending":case"Output Limit Exceeded":case"Submission Error":return"#000000";case"Accepted":return"#00C703";case"Time Limit Exceeded":return"#001BEB";case"Wrong Answer":return"#FF0000";case"Compile Error":return"#FFC400";case"Memory Limit Exceeded":return"#9900FF";case"Run Time Error":return"#949400";default:return"#000000"}}function getVerdictDescription(e){switch(e){case"Pending":return"Your submission is still in judge queue, please be patient.";case"Accepted":return"Your program is correct. Congratulations!";case"Output Limit Exceeded":return"Your program produced too much output.";case"Time Limit Exceeded":return"Your program runs longer than the specified time limit.";case"Wrong Answer":return"Your program produced incorrect output.";case"Compile Error":return"Your program can't be compiled by our compiler. You can see the compile error message in your submission detail (click on the id of your submission, it is the most left column of this row).";case"Memory Limit Exceeded":return"Your program tried to use more memory than the specified memory limit.";case"Run Time Error":return"Your program crashed during execution (e.g. segmentation fault, floating point exception, etc.)";case"Submission Error":return"There is something wrong in the server, please contact the administrator, your submission will be rejudged later.";default:return""}}function getBrowseProblemByContestStructure(){return{}}function generateRandomString(e,t){for(var o="",n=0;t>n;n++)o+=e[Math.floor(Math.random()*e.length)];return o}function toCamelCase(e){e=e.replace(e.charAt(0),e.charAt(0).toUpperCase());for(var t=1;t<e.length;t++)" "!==e.charAt(t)&&(e.charAt(t)===e.charAt(t).toUpperCase()?(e=e.substring(0,t)+" "+e.substring(t),t++):"_"===e.charAt(t)&&(e.replace(e.charAt(t)," "),e.replace(e.charAt(t+1),e.charAt(t+1).toUpperCase()),t+=2));return e}function getPageArr(e,t,o){var n=[],r=!1,a=7;isNaN(o)||(a=o);for(var s=1;t>=s;s++)Math.abs(s-e)<=a||1==s||s==t||2==s&&Math.abs(s-e)<=a+1||s==t-1&&Math.abs(s-e)<=a+1?(n.push({"class":s==e?"active":"",pageNo:s}),r=!1):0==r&&(n.push({"class":"",pageNo:"..."}),r=!0);return n}function parseToHTML(e,t){return e.trustAsHtml(t)}function setCookie(e,t,o,n){var r=e+"="+t+";";if(void 0!==o){var a=new Date;a.setTime(a.getTime()+o);var s="expires="+a.toUTCString()+";";r+=" "+s}r+=void 0!==n?" path=/"+n+";":" path=/;",document.cookie=r}function deleteCookie(e,t){var o=e+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC;";void 0!==t&&(o+=" path=/"+t+";"),document.cookie=o}function getCookie(e){for(var t=document.cookie.split("; "),o=0;o<t.length;o++)if(-1!==t[o].indexOf(e+"=")){var n=t[o].substring(t[o].indexOf("=")+1);return n}return void 0}function isEmptyObject(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function configRoute(e){e.when("/",{templateUrl:"/static/html/home.html",title:"PSU Online Judge",meta:{property:{"og:description":"Jollybee Online Judge, competitive programmers' hive to train their skills!"}}}).when("/user/login",{templateUrl:"/static/html/login.html",controller:"UserCtrl",title:"Login",meta:{property:{"og:description":"Login to the hive!"}}}).when("/user/view/:username",{templateUrl:"/static/html/profile.html",title:function(e){return"Profile - "+e.username},meta:{property:{"og:description":"Take a peek of your fellow bee profile!"}}}).when("/user/reset/password",{templateUrl:"/static/html/reset_password.html",title:"Reset Password",meta:{property:{"og:description":"Forget the password to this hive? Reset here!"}}}).when("/user/feedback",{templateUrl:"/static/html/feedback.html",title:"Feedback",meta:{property:{"og:description":"Have some suggestion? Want to report bugs?"}}}).when("/user/rank",{templateUrl:"/static/html/rank.html",title:"Ranks",meta:{property:{"og:description":"Jollybee Online Judge ranks."}}}).when("/problem",{templateUrl:"/static/html/problems.html",title:"Problems",meta:{property:{"og:description":"List of problems in this hive, help your fellow bees to solve the problems!"}}}).when("/problem/view/:problemId",{templateUrl:"/static/html/problem_detail.html",title:function(e){return"Problem - "+e.problemId},meta:{property:{"og:description":"One of the problems to be solved. Other bees are solving this problem, can you help them?"}}}).when("/user/authoring",{templateUrl:"/static/html/authoring.html",title:"Authoring",meta:{property:{"og:description":"Make problems to be solved by others!"}}}).when("/user/mentorship",{templateUrl:"/static/html/mentorship.html",title:"Mentorship",meta:{property:{"og:description":"Tell me and I forget, teach me and I may remember, involve me and I learn."}}}).when("/user/contest",{templateUrl:"/static/html/contest.html",title:"Contests",meta:{property:{"og:description":"Like competition? Here is list of available contests!"}}}).when("/user/contest/:contestId/about",{templateUrl:"/static/html/includes/contest/about.html",title:"Contest - About",meta:{property:{"og:description":"What is this contest about? Find out the details here!"}}}).when("/user/contest/:contestId/problem",{templateUrl:"/static/html/includes/contest/problems.html",title:"Contest - Problem",meta:{property:{"og:description":"Bring it on!"}}}).when("/user/contest/:contestId/rating",{templateUrl:"/static/html/includes/contest/rating.html",title:"Contest - Rating Changes",meta:{property:{"og:description":"List of rating changes of contestants."}}}).when("/user/contest/:contestId/editorial",{templateUrl:"/static/html/includes/contest/editorial.html",title:"Contest - Editorial",meta:{property:{"og:description":"See the editorial of a contest. It's time to read and understand things!"}}}).when("/user/contest/:contestId/scoreboard",{templateUrl:"/static/html/includes/contest/scoreboard.html",title:"Contest - Scoreboard",meta:{property:{"og:description":"See current scoreboard of a contest. The queen is so proud of these bees.","og:image":"https://jollybeeoj.com/images/contest_scoreboard.png"}}}).when("/user/contest/:contestId/judgestatus",{templateUrl:"/static/html/includes/contest/judge_status.html",title:"Contest - Judge Status",meta:{property:{"og:description":"See current status of submission. Queen's workers are ready to take more submission to be judged."}}}).when("/user/contest/:contestId/clarification",{templateUrl:"/static/html/includes/contest/clarification.html",title:"Contest - Clarification",meta:{property:{"og:description":"Found ambiguous description in a problem, ask here! Queen's workers will gladly answer your question."}}}).when("/user/contest/:contestId/problem/:problemId",{templateUrl:"/static/html/includes/contest/problem_detail.html",title:"Contest - Problem",meta:{property:{"og:description":"Bring it on!"}}}).when("/user/contest/:contestId/submission/:submissionId",{templateUrl:"/static/html/includes/contest/submission_detail.html",title:"Contest - Submission",meta:{property:{"og:description":"See specific submission in details."}}}).when("/submission",{templateUrl:"/static/html/submissions.html",title:"Submissions",meta:{property:{"og:description":"Queen's workers always stand by to get more submission to be judged. This is the list of last submission submitted and judged."}}}).when("/submission/view/:submissionId",{templateUrl:"/static/html/submission_detail.html",title:function(e){return"Submission - "+e.submissionId},meta:{property:{"og:description":"See specific submission in details."}}}).when("/user/about",{templateUrl:"/static/html/about.html",title:"About Jollybee Online Judge",meta:{property:{"og:description":"What is Jollybee Online Judge?"}}}).when("/user/tools",{templateUrl:"/static/html/tools.html",title:"Tools",meta:{property:{"og:description":"Need something to update or manage the hive? Sure thing!"}}}).when("/user/policies/privacy",{templateUrl:"/static/html/privacy.html",title:"Privacy Policy"}).when("/user/policies/terms",{templateUrl:"/static/html/terms.html",title:"Terms and Conditions"}).otherwise({redirectTo:"/"})}function configLocation(e){e.html5Mode(!0),e.hashPrefix("#!")}function configHttp(e){e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";var t=function(e){var o,n,r,a,s,i,c,l="";for(o in e)if(n=e[o],n instanceof Array)for(c=0;c<n.length;++c)s=n[c],r=o+"["+c+"]",i={},i[r]=s,l+=t(i)+"&";else if(n instanceof Object)for(a in n)s=n[a],r=o+"["+a+"]",i={},i[r]=s,l+=t(i)+"&";else void 0!==n&&null!==n&&(l+=encodeURIComponent(o)+"="+encodeURIComponent(n)+"&");return l.length?l.substr(0,l.length-1):l};e.defaults.transformRequest=[function(e){return angular.isObject(e)&&"[object File]"!==String(e)?t(e):e}]}function addHoverCard(e,t){$("#hoverCard").remove(),$(e).append("<div onmouseenter='clearTimeout(hoverCardPromise)' onmouseleave='removeHoverCard()' id='hoverCard'>"+t+"</div>")}function removeHoverCard(e){(null===e||void 0===e)&&(e=500),clearTimeout(hoverCardPromise),hoverCardPromise=setTimeout(function(){$("#hoverCard").remove(),hoverCard_username=null},e)}function addHoverCard_username(e,t){"undefined"!=typeof e.altKey&&(e=e.target),t!==hoverCard_username&&(clearTimeout(hoverCardPromise),hoverCardPromise=setTimeout(function(){$.ajax({url:"/user/view/row/"+t,method:"POST",success:function(t){if(null!==t&&""!==t){var o="<table style='padding-right:0px;'><tr style='display:none;'></tr><tr><td><img style='width:100px; height:100px;' src='/user/profile/thumbnail/u/"+t.username+"' onerror='this.onerror=null; this.src=\"/images/default.jpg\";'></img></td><td style='padding-left:5px; text-align:left; vertical-align:top;'><table><tr style='display:none;'></tr><tr><td colspan=3><span style='font-size:20px;'>"+t.username+"</span></td></tr><tr><td colspan=3><span style='font-size:14px;'>"+t.ratingTitle+"</span></td></tr><tr style='color:black; font-weight:normal'><td>Name</td><td>:</td><td>"+t.name+"</td></tr><tr style='color:black; font-weight:normal'><td>Rating</td><td>:</td><td>"+t.rating+"</td></tr><tr style='color:black; font-weight:normal'><td>Level</td><td>:</td><td>"+(t.level+1)+"</td></tr></table></td></tr></table>";hoverCard_username=t.username,addHoverCard(e,o)}},error:function(e){console.log(e)}})},500))}function getCaretCharacterOffsetWithin(e){var t,o=0,n=e.ownerDocument||e.document,r=n.defaultView||n.parentWindow;if("undefined"!=typeof r.getSelection){if(t=r.getSelection(),t.rangeCount>0){var a=r.getSelection().getRangeAt(0),s=a.cloneRange();s.selectNodeContents(e),s.setEnd(a.endContainer,a.endOffset),o=s.toString().length}}else if((t=n.selection)&&"Control"!=t.type){var i=t.createRange(),c=n.body.createTextRange();c.moveToElementText(e),c.setEndPoint("EndToEnd",i),o=c.text.length}return o}function getCaretPosition(e){var t=0;if(document.selection&&-1==navigator.appVersion.indexOf("MSIE 10")){e.focus();var o=document.selection.createRange();o.moveStart("character",-e.value.length),t=o.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart);return t}function setCaretPosition(e,t){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,t);else if(e.createTextRange){var o=e.createTextRange();o.collapse(!0),o.moveEnd("character",t),o.moveStart("character",t),o.select()}}function placeCaretAtEnd(e){if(e.focus(),"undefined"!=typeof window.getSelection&&"undefined"!=typeof document.createRange){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var o=window.getSelection();o.removeAllRanges(),o.addRange(t)}else if("undefined"!=typeof document.body.createTextRange){var n=document.body.createTextRange();n.moveToElementText(e),n.collapse(!1),n.select()}}angular.module("announcementModule",["helperModule"]).controller("announcementCtrl",["$scope","$http","$sce","Helper",function(e,t,o,n){e.isWorking=!1,e.currPageNum=1,e.numOfAnnouncement=5,e.announcementCount=0,e.totalPage=0,e.announcements={},e.pages={},e.announcementData=void 0,e.prevPage=function(){e.currPageNum>1&&(e.currPageNum--,e.populateAnnouncements())},e.nextPage=function(){e.currPageNum<e.totalPage&&(e.currPageNum++,e.populateAnnouncements())},e.populateAnnouncements=function(o){void 0===o||isNaN(o)||(e.currPageNum=o),t.post("/announcement/view/"+e.currPageNum).success(function(t){e.announcements=t}).error(function(e){console.log("error: "+e)}),t.post("/announcement/count").success(function(t){e.announcementCount=t,e.totalPage=Math.ceil(e.announcementCount/e.numOfAnnouncement),e.pages=n.getPageArr(e.currPageNum,e.totalPage)}).error(function(e){console.log("error: "+e)})},e.parseToHTML=function(e){return n.parseToHTML(o,e)},e.addAnnouncement=function(){e.isWorking=!0;var t=new FormData;angular.forEach(e.announcementData,function(e,t){this.append(t,e)},t),$.ajax({type:"POST",url:"/announcement/tools/add",data:t,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.msg=t,e.isWorking=!1})},error:function(t){e.isWorking=!1,console.log("error"),console.log(t)}})},e.updateAnnouncement=function(){e.isWorking=!0;var t=new FormData;angular.forEach(e.announcementData,function(e,t){this.append(t,e)},t),$.ajax({type:"POST",url:"/announcement/tools/update",data:t,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.msg=t,e.isWorking=!1})},error:function(t){e.isWorking=!1,console.log("error"),console.log(t)}})},e.populateAnnouncementsForTools=function(){t.post("/announcement/tools/data/announcement").success(function(t){e.announcements=t}).error(function(e){console.log("error"),console.log(e)})}}]),angular.module("clarificationModule",["userModule","helperModule"]).service("UnreadSvc",[function(){return{unreadIds:[],setUnreads:function(e){this.unreadIds=e},getUnreads:function(){return this.unreadIds}}}]).controller("ClarificationCtrl",["$scope","$routeParams","$http","Helper","UserDataSvc","UnreadSvc",function(e,t,o,n,r,a){e.unreads=[],e.clarifications=[],e.clarificationData={},e.allowedToAnswer=null,e.msg="",e.skipAdding=!1,e.hasCheckedUser=!1,e.isWorking=!1,e.isCollapsed={},e.$watch(function(){return a.getUnreads()},function(){if(void 0!==a.unreadIds)if(e.skipAdding)e.skipAdding=!1;else{var t=a.unreadIds[0];isNaN(t)||e.loadClarificationById(t,!1)}},!0),e.$watch(function(){return r.getData()},function(){void 0===r.getData()||e.hasCheckedUser||(e.hasCheckedUser=!0,e.checkIfAllowedToAnswer())},!0),e.toggleClarificationCollapse=function(t){(void 0===e.isCollapsed[t]||null===e.isCollapsed[t])&&(e.isCollapsed[t]=!1),e.isCollapsed[t]=!e.isCollapsed[t]},e.loadContestData=function(){o.post("/announcement/contest/view/"+t.contestId).success(function(t){e.contestData=t}).error(function(e){console.log("error"),console.log(e)})},e.loadContestProblem=function(){o.post("/problem/contest/"+t.contestId).success(function(t){e.problems=t,void 0!==e.problems&&null!==e.problems&&""!==e.problems&&(e.problems.sort(function(e,t){return e.problemCode<t.problemCode?-1:e.problemCode>t.problemCode?1:0}),e.problems.unshift({problemId:0,problemCode:0,title:"General"}))}).error(function(e){console.log("error"),console.log(e)})},e.sendClarification=function(){if(void 0===e.clarificationData.problemId||null===e.clarificationData.problemId||""===e.clarificationData.problemId||null===e.clarificationData.subject||void 0===e.clarificationData.subject||""===e.clarificationData.subject||void 0===e.clarificationData.question||""===e.clarificationData.question||null===e.clarificationData.question)return void(e.msg="Please fill all the fields to request for a clarification");var n={contestId:t.contestId,problemId:e.clarificationData.problemId,subject:e.clarificationData.subject,question:e.clarificationData.question};void 0!==n.problemId&&void 0!==n.subject&&void 0!==n.question&&void 0!==n.contestId&&(e.isWorking=!0,o.post("/announcement/contest/clarification/send",n).success(function(t){t=parseInt(t),null!==t&&""!==t&&void 0!==t&&NaN!==t&&(t>=0?e.loadClarificationById(t,!0):-1==t?e.msg="Must be logged in to request for a clarification":-2==t?e.msg="You are not registered in this contest":-3==t&&(e.msg="Contest is not running")),e.isWorking=!1}).error(function(t){console.log("error"),console.log(t),e.isWorking=!1}))},e.sendAnnouncement=function(){var n={contestId:t.contestId,problemId:e.clarificationData.problemId,subject:e.clarificationData.subject,answer:e.clarificationData.announcement};void 0!==n.problemId&&void 0!==n.subject&&void 0!==n.answer&&void 0!==n.contestId&&(e.isWorking=!0,o.post("/announcement/contest/clarification/announcement",n).success(function(t){null!==t&&e.loadClarificationById(t,!0),e.isWorking=!1}).error(function(t){console.log("error"),console.log(t),e.isWorking=!1}))},e.loadAllClarification=function(){var r={contestId:t.contestId};o.post("/announcement/contest/clarification/list",r).success(function(o){if(e.unreads=[],e.clarifications=o,null!==o&&""!==o&&void 0!==o){var r=n.getCookie("readAnnouncement_"+t.contestId);void 0!==r&&(r=JSON.parse(r));for(var s=0;s<o.length;s++)"Announcement"===o[s].status?void 0!==r?-1===r.indexOf(o[s].clarificationId)?e.unreads.unshift(o[s].clarificationId):e.clarifications[s].isRead=!0:e.unreads.unshift(o[s].clarificationId):o[s].isRead===!1&&e.unreads.unshift(o[s].clarificationId)}a.setUnreads(e.unreads)}).error(function(e){console.log("error"),console.log(e)})},e.loadAllClarificationSpecial=function(){var r={contestId:t.contestId};o.post("/announcement/contest/clarification/list/all",r).success(function(o){if(e.unreads=[],e.clarifications=o,null!==o&&void 0!==o&&""!==o){var r=n.getCookie("readAnnouncement_"+t.contestId);void 0!==r&&(r=JSON.parse(r));for(var s=0;s<o.length;s++)"Announcement"===o[s].status?void 0!==r?-1===r.indexOf(o[s].clarificationId)?e.unreads.unshift(o[s].clarificationId):e.clarifications[s].isRead=!0:e.unreads.unshift(o[s].clarificationId):o[s].isAnswered===!1&&e.unreads.unshift(o[s].clarificationId)}a.setUnreads(e.unreads)}).error(function(e){console.log("error"),console.log(e)})},e.checkIfAllowedToAnswer=function(){if(void 0!==r.getData()){var n={contestId:t.contestId};o.post("/announcement/contest/special/check",n).success(function(t){e.allowedToAnswer=t,e.allowedToAnswer?e.loadAllClarificationSpecial():e.loadAllClarification()}).error(function(e){console.log("error"),console.log(e)})}},e.loadClarificationById=function(n,r){var a={contestId:t.contestId,clarificationId:n};null!==a.clarificationId&&void 0!==a.clarificationId&&""!==a.clarificationId&&o.post("/announcement/contest/clarification",a).success(function(t){if(null!==t){for(var o=0;o<e.clarifications.length;o++)if(e.clarifications[o].clarificationId==n){e.clarifications.splice(o,1);break}r===!0&&e.markAsRead(t),t.isRead=r,e.clarifications.unshift(t)}}).error(function(e){console.log("error"),console.log(e)})},e.parseDateReadable=function(t){var o=new Date(t);return("0"+o.getDate()).slice(-2)+"-"+e.monthNames[o.getMonth()]+"-"+o.getFullYear()+" "+("0"+o.getHours()).slice(-2)+":"+("0"+o.getMinutes()).slice(-2)+":"+("0"+o.getSeconds()).slice(-2)},e.submitAnswer=function(t){var n={clarificationId:t.clarificationId,clarificationUserId:t.userId,contestId:t.contestId,answer:t.answer};void 0!==n.clarificationId&&void 0!==n.clarificationUserId&&void 0!==n.contestId&&void 0!==n.answer&&(e.isWorking=!0,o.post("/announcement/contest/clarification/update",n).success(function(o){if(o){e.markAsAnswered(t),e.msg[t.clarificationId]="Sent",setTimeout(function(){e.msg[t.clarificationId]=""},1e3),t.isAnswered=!0,t.status="Answered";var n=e.unreads.indexOf(t.clarificationId);-1!==n&&(e.skipAdding=!0,e.unreads.splice(n,1),a.setUnreads(e.unreads))}else alert("Failed to update clarification");e.isWorking=!1}).error(function(t){console.log("error"),console.log(t),e.isWorking=!1}))},e.setRead=function(o){if(!o.isRead){e.unreads=a.unreadIds;var r=e.clarifications.indexOf(o);-1!==r&&(e.clarifications[r].isRead=!0);var s=e.unreads.indexOf(o.clarificationId);-1!==s&&(e.skipAdding=!0,e.unreads.splice(s,1),a.setUnreads(e.unreads))}if("Announcement"===o.status){var i=n.getCookie("readAnnouncement_"+t.contestId);i=void 0===i?[]:JSON.parse(i),-1===i.indexOf(o.clarificationId)&&i.unshift(o.clarificationId),n.setCookie("readAnnouncement_"+t.contestId,JSON.stringify(i),e.contestData.endTime-(new Date).getTime()+2592e5,"")}},e.markAsRead=function(t){var n={clarificationId:t.clarificationId};t.isRead||("Announcement"!==t.status?o.post("/announcement/contest/clarification/mark/read",n).success(function(o){e.setRead(t)}).error(function(e){console.log("error"),console.log(e)}):e.setRead(t))},e.markAsAnswered=function(n){var r={clarificationId:n.clarificationId,contestId:t.contestId};o.post("/announcement/contest/clarification/mark/answered",r).success(function(t){e.setRead(n)}).error(function(e){console.log("error"),console.log(e)})}}]).controller("ClarificationSocketCtrl",["$scope","$location","$routeParams","$http","UserDataSvc","UnreadSvc","Helper",function(e,t,o,n,r,a,s){e.unreads=[],e.contestData={},e.isFirst=!0,e.allowedToAnswer=!1,e.hasCheckedUser=!1,e.reconnectClarificationSocketTimeout=void 0,e.stompClient=void 0,e.socket=void 0,e.$watch(function(){return a.getUnreads()},function(){e.isFirst?e.isFirst=!1:e.unreads=a.getUnreads()},!0),e.$watch(function(){return r.getData()},function(){void 0===r.getData()||e.hasCheckedUser||(e.hasCheckedUser=!0,e.checkIfAllowedToAnswer())},!0),e.loadContestData=function(){n.post("/announcement/contest/view/"+o.contestId).success(function(t){e.contestData=t}).error(function(e){console.log("error"),console.log(e)})},e.checkIfAllowedToAnswer=function(){if(void 0!==r.getData()){var t={contestId:o.contestId};n.post("/announcement/contest/special/check",t).success(function(t){e.allowedToAnswer=t,e.allowedToAnswer?e.loadAllClarificationSpecial():e.loadAllClarification(),e.connect()}).error(function(e){console.log("error"),console.log(e)})}},e.loadAllClarification=function(){n.post("/announcement/contest/clarification/list",{contestId:o.contestId}).success(function(t){if(e.unreads=[],null!==t&&""!==t&&void 0!==t){var n=s.getCookie("readAnnouncement_"+o.contestId);void 0!==n&&(n=JSON.parse(n));for(var r=0;r<t.length;r++)"Announcement"===t[r].status?void 0!==n?-1===n.indexOf(t[r].clarificationId)&&e.unreads.unshift(t[r].clarificationId):e.unreads.unshift(t[r].clarificationId):t[r].isRead===!1&&e.unreads.unshift(t[r].clarificationId)}a.setUnreads(e.unreads)}).error(function(e){console.log("error"),console.log(e)})},e.loadAllClarificationSpecial=function(){n.post("/announcement/contest/clarification/list/all",{contestId:o.contestId}).success(function(t){if(e.unreads=[],null!==t&&void 0!==t&&""!==t){var n=s.getCookie("readAnnouncement_"+o.contestId);void 0!==n&&(n=JSON.parse(n));for(var r=0;r<t.length;r++)"Announcement"===t[r].status?void 0!==n?-1===n.indexOf(t[r].clarificationId)&&e.unreads.unshift(t[r].clarificationId):e.unreads.unshift(t[r].clarificationId):t[r].isAnswered===!1&&e.unreads.unshift(t[r].clarificationId)}a.setUnreads(e.unreads)}).error(function(e){console.log("error"),console.log(e)})},e.$on("$routeChangeStart",function(t,o){void 0!==e.stompClient&&e.stompClient.disconnect(),clearTimeout(e.reconnectClarificationSocketTimeout)}),e.connect=function(){e.socket=new SockJS("localhost"===t.host()?"https://localhost:8443/websocket/general/endpoint":"https://jollybeeoj.com/websocket/general/endpoint"),e.stompClient=Stomp.over(e.socket),e.stompClient.debug=null,e.stompClient.connect({},function(t){var n="",s="";e.allowedToAnswer?n="/websocket/subscribe/announcement/contest/clarification/special/"+o.contestId:void 0!==r.getData()&&(n="/websocket/subscribe/announcement/contest/clarification/"+o.contestId+"/"+r.getData().userId,s="/websocket/subscribe/announcement/contest/clarification/announcement/"+o.contestId),""!==n&&(e.stompClient.subscribe(n,function(t){var o=Number(t.body);e.$apply(function(){-1===e.unreads.indexOf(o)&&(e.unreads.unshift(o),a.setUnreads(e.unreads))})}),""!==s&&e.stompClient.subscribe(s,function(t){var o=Number(t.body);e.$apply(function(){e.unreads.unshift(o),a.setUnreads(e.unreads)})}))},function(t){e.reconnectClarificationSocketTimeout=setTimeout(function(){e.connect()},1e4)})}}]),angular.module("contestModule",["helperModule"]).filter("contestIsNotAddedIn",function(){return function(e,t){for(var o=t.addedProblemList,n={},r=0;r<e.length;r++){var a=e[r].problemId;o.hasOwnProperty(a)||(n[a]=e[r].title)}return n}}).controller("contestCtrl",["$scope","$http","$location","$interval","Helper","ServerTimeSvc",function(e,t,o,n,r,a){e.isWorking=!1,e.contests={},e.pages=[],e.registerMsg=[],e.monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],e.countDownPromise=void 0,e.currTimeSynchronizePromise=void 0,e.currTime,e.$on("$routeChangeStart",function(t,n){var r=o.path();"/"!==r&&e.stopCountDown()}),e.isEmptyObject=function(e){return r.isEmptyObject(e)},e.parseDateReadable=function(t){var o=new Date(t);return("0"+o.getDate()).slice(-2)+"-"+e.monthNames[o.getMonth()]+"-"+o.getFullYear()+" "+("0"+o.getHours()).slice(-2)+":"+("0"+o.getMinutes()).slice(-2)+":"+("0"+o.getSeconds()).slice(-2)},e.loadUpcomingContest=function(){t.post("/announcement/contest/view/current").success(function(t){e.contests=t}).error(function(e){console.log("error"),console.log(e)})},e.loadAllContests=function(){t.post("/announcement/tools/data/contest").success(function(t){e.contests=t;for(var o=0;o<e.contests.length;o++)e.contests[o].hasFinished=e.currTime>e.contests[o].endTime}).error(function(e){console.log("errror"),console.log(e)})},e.getDuration=function(e,t){var o=Math.abs(t-e),n=new Date(o);return n=new Date(n.getTime()+6e4*n.getTimezoneOffset()),Math.floor(o/36e5)+" h(s) "+("0"+n.getMinutes()).slice(-2)+" min(s)"},e.contestAboutPath=function(e){return"/user/contest/"+e+"/about"},e.registerContest=function(t){var o=new FormData;o.append("contestId",t),$.ajax({type:"POST",url:"/user/contest/register",data:o,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){alert(t),e.isWorking=!1,e.loadAllContests()})},error:function(t){e.isWorking=!1,console.log("error"),console.log(t)}})},e.getCurrentGlobalTimestamp=function(t){e.currTime=a.currentServerTime(),void 0===e.currTime||NaN===e.currTime?setTimeout(function(){e.getCurrentGlobalTimestamp(t)},1e4):t&&t()},e.updateCountDown=function(){if(e.isEmptyObject(e.contests))e.cdMsg="No upcoming contests";else if(e.currTime+=1e3,e.contests[0].startTime>e.currTime?(e.cdMsg="before "+e.contests[0].title,e.targetTime=e.contests[0].startTime):e.contests[0].endTime>=e.currTime?(e.cdMsg="time remaining on "+e.contests[0].title,e.targetTime=e.contests[0].endTime):e.contests[0].endTime<e.currTime&&(e.cdMsg=e.contests[0].title+" has finished",e.targetTime=void 0,e.contests.shift()),void 0!==e.targetTime){var t=Math.abs(e.currTime-e.targetTime),o=new Date(t);o=new Date(o.getTime()+6e4*o.getTimezoneOffset()),e.countDownTime=Math.floor(t/36e5)+" : "+("0"+o.getMinutes()).slice(-2)+" : "+("0"+o.getSeconds()).slice(-2)}},e.synchronizeCurrentTime=function(){e.getCurrentGlobalTimestamp(),e.currTimeSynchronizePromise=n(e.getCurrentGlobalTimestamp,6e5)},e.startCountDown=function(t){e.countDownPromise=n(e.updateCountDown,1e3)},e.stopCountDown=function(){n.cancel(e.countDownPromise),n.cancel(e.currTimeSynchronizePromise)}}]).controller("contestToolsCtrl",["$scope","$http","Helper",function(e,t,o){e.isWorking=!1,e.contests={},e.addedProblemList={},e.problemList=[],e.contestData=void 0,e.allLanguages=[],e.languages=[],e.grantedUsers=[],e.dummyUsers=[],e.contestProblems=[],e.autocomplete={},e.startDateData={day:31,month:12,year:2015,hour:23,minute:59,second:59},e.endDateData={day:31,month:12,year:2015,hour:23,minute:59,second:59},e.triggerUpdateRating=function(){var t=e.contestData.contestId,o=e.contestData.title;if(confirm("Are you sure you want to update rating for contest "+t+" - "+o+" ? This action can't be undone")){e.isWorking=!0;var n=new FormData;n.append("contestId",t),$.ajax({type:"POST",url:"/announcement/tools/contest/trigger/rating",data:n,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.msg=t,e.isWorking=!1})},error:function(e){console.log("data")}})}},e.triggerAddContestProblemToArchive=function(){var t=e.contestData.contestId,o=e.contestData.title;if(confirm("Are you sure you want to add contest problems in "+t+" - "+o+" to archive? This action can't be undone")){e.isWorking=!0;var n=new FormData;n.append("contestId",t),$.ajax({type:"POST",url:"/problem/tools/contest/trigger/copyToArchive",data:n,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.msg=t,e.isWorking=!1})},error:function(e){console.log("data")}})}},$("#dummyUserInput").keyup(function(t){13===t.keyCode&&""!==e.autocomplete.dummyUser&&e.$apply(function(){-1===$.inArray(e.autocomplete.dummyUser,e.dummyUsers)&&e.dummyUsers.push(e.autocomplete.dummyUser),e.autocomplete.dummyUser=""})}),$("#grantedUserInput").keyup(function(t){13===t.keyCode&&""!==e.autocomplete.grantedUser&&e.$apply(function(){-1===$.inArray(e.autocomplete.grantedUser,e.grantedUsers)&&e.grantedUsers.push(e.autocomplete.grantedUser),e.autocomplete.grantedUser=""})}),e.getAutocompleteUsername=function(e){return t.post("/user/autocomplete",{pattern:e}).then(function(e){return e.data})},e.loadHiddenProblems=function(){t.post("problem/view/hidden").success(function(t){e.problemList=t}).error(function(e){console.log("error"),console.log(e)})},e.loadAllContests=function(){t.post("/announcement/tools/data/contest").success(function(t){e.contests=t}).error(function(e){console.log("errror"),console.log(e)})},e.loadAddedProblem=function(){t.post("/problem/tools/data/problem_contest",{contestId:e.contestData.contestId}).success(function(t){for(var o=0;o<t.length;o++)e.addedProblemList[t[o].problemId]=t[o].title}).error(function(e){console.log("errror"),console.log(e)})},e.moveProblemToAddedList=function(t,o){e.addedProblemList[t]=o},e.deleteProblemFromAddedList=function(t){delete e.addedProblemList[t]},e.getLanguages=function(){t.post("/submission/view/language").success(function(t){e.allLanguages=t}).error(function(e){console.log("error:"+e)})},e.loadContestLanguage=function(){t.post("/submission/view/language/"+e.contestData.contestId).success(function(t){e.contestData.languages=t}).error(function(e){console.log("error"),console.log(e)})},e.loadAuthorizedContests=function(){t.post("/announcement/tools/contest/user/special_privilege").success(function(t){e.contests=t}).error(function(e){console.log("error"),console.log(e)})},e.processData=function(){t.post("/announcement/contest/view/"+e.contestData.contestId).success(function(t){e.contestData=t,e.parseDateTo(e.contestData.startTime,e.startDateData),e.parseDateTo(e.contestData.endTime,e.endDateData)}).error(function(e){console.log(e)}),e.loadContestLanguage(),e.loadGrantedUser(),e.loadDummyUser()},e.parseDateTo=function(e,t){var o=new Date(e);t.day=o.getDate(),t.month=o.getMonth()+1,t.year=o.getFullYear(),t.hour=o.getHours(),t.minute=o.getMinutes(),t.second=o.getSeconds()},e.addContest=function(){e.isWorking=!0,e.contestData.startTimeLong=new Date(e.startDateData.year,e.startDateData.month-1,e.startDateData.day,e.startDateData.hour,e.startDateData.minute,e.startDateData.second).getTime(),e.contestData.endTimeLong=new Date(e.endDateData.year,e.endDateData.month-1,e.endDateData.day,e.endDateData.hour,e.endDateData.minute,e.endDateData.second).getTime(),
e.contestData.openRegistration||(e.contestData.openRegistration=!1),e.contestData.allowSubmissionAfterAccepted||(e.contestData.allowSubmissionAfterAccepted=!1),e.contestData.revealFullScoreboard||(e.contestData.revealFullScoreboard=!1),e.contestData.revealProblemToPublic||(e.contestData.revealProblemToPublic=!1);var t=new FormData;angular.forEach(e.contestData,function(e,t){this.append(t,e)},t),t.append("specialPrivilegeUsername",e.grantedUsers),t.append("dummyUsername",e.dummyUsers),$.ajax({type:"POST",url:"/announcement/tools/contest/add",data:t,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.msg=t})},error:function(e){console.log("error"),console.log(e)},completed:function(){e.$apply(function(){e.isWorking=!1})}})},e.updateContest=function(){e.isWorking=!0,e.contestData.startTimeLong=new Date(e.startDateData.year,e.startDateData.month-1,e.startDateData.day,e.startDateData.hour,e.startDateData.minute,e.startDateData.second).getTime(),e.contestData.endTimeLong=new Date(e.endDateData.year,e.endDateData.month-1,e.endDateData.day,e.endDateData.hour,e.endDateData.minute,e.endDateData.second).getTime();var t=new FormData;angular.forEach(e.contestData,function(e,t){this.append(t,e)},t);for(var o=[],n=0;n<e.contestData.languages.length;n++)o.push(e.contestData.languages[n]);t.append("allowedLanguage",o),t.append("specialPrivilegeUsername",e.grantedUsers),t.append("dummyUsername",e.dummyUsers),$.ajax({type:"POST",url:"/announcement/tools/contest/update",data:t,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.msg=t,e.isWorking=!1})},error:function(t){e.isWorking=!1,console.log("error"),console.log(t)}})},e.deleteLanguage=function(t){e.contestData.languages.splice(t,1)},e.loadGrantedUser=function(o){t.post("/announcement/tools/contest/special_privilege",{contestId:e.contestData.contestId}).success(function(t){e.grantedUsers=[];for(var o=0;o<t.length;o++)e.grantedUsers.push(t[o].username)}).error(function(e){console.log("error"),console.log(e)})},e.loadDummyUser=function(){t.post("/announcement/tools/contest/dummy_user",{contestId:e.contestData.contestId}).success(function(t){e.dummyUsers=[];for(var o=0;o<t.length;o++)e.dummyUsers.push(t[o].username)}).error(function(e){console.log("error"),console.log(e)})},e.deleteGrantedUser=function(t){e.grantedUsers.splice(t,1)},e.deleteDummyUser=function(t){e.dummyUsers.splice(t,1)},$("#inputLanguage").keyup(function(t){if(13===t.keyCode&&""!==$("#inputLanguage").val()){var o=$("#inputLanguage").val();$("#inputLanguage").val("");var n=$.grep(e.contestData.languages,function(e,t){return e===o});0===n.length&&e.$apply(function(){e.contestData.languages.push(o)})}})}]).controller("contestDetailCtrl",["$scope","$http","$routeParams","$sce","$location","$interval","Helper","$anchorScroll","UserDataSvc","ServerTimeSvc",function(e,t,o,n,r,a,s,i,c,l){e.addHoverCard_username=addHoverCard_username,e.removeHoverCard=removeHoverCard,e.sterilizeUsername=s.sterilizeUsername,e.isWorking=!1,e.targetTime=void 0,e.countDownTime="--:--:--",e.cdMsg="-",e.countDownPromise=void 0,e.currTimeSynchronizePromise=void 0,e.contestData={},e.contestProblems={},e.contestProblemPath={},e.contestRating={},e.contestRatingHighlightUser={},e.rating={},e.editorial={},e.scoreboardData={},e.scoreboardZeroPointRank=0,e.scoreboardLastUpdateTime=-1,e.currentPage="",e.languages=[],e.monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],e.currTime=void 0,e.scoreboardShowDummy=!1,e.scoreboardShowFull=!1,e.userStatusInContest="",e.allowRevealFullScoreboard=!1,e.allowRevealEditorial=!1,e.flag_runner_tool=!1,e.flaggedCell={},e.updateContestScoreboardTimeout=null,e.$on("$routeChangeStart",function(t,n){var a=r.path();a!=="/user/contest/"+o.contestId&&e.stopCountDown(),clearTimeout(e.updateContestScoreboardTimeout)}),e.parseToHTML=function(e){return s.parseToHTML(n,e)},e.$watch(function(){return c.getData()},function(){e.userDataShared=c.getData()}),e.loadRatingData=function(){t.post("/announcement/contest/rating",{contestId:o.contestId}).success(function(t){e.contestRating=t,void 0!==o.user&&(e.contestRatingHighlightUser=o.user,r.hash("anchor"+e.contestRatingHighlightUser),i.yOffset=100,setTimeout(function(){i()},1e3))}).error(function(e){console.log(e)})},e.rating.shareToFacebook=function(t){for(var o,n,r,a,s=0;s<e.contestRating.length;s++)if(e.contestRating[s].username===t){var i=e.contestRating[s];r=i.changes,r>0&&(r="+"+r),o=i.oldRatingTitle,n=i.newRatingTitle,a=i.userId;break}var c;c=o===n?"I just got "+r+" rating from "+e.contestData.title+". Check it out here!":"I just got promoted from "+o+" to "+n+" from "+e.contestData.title+". Check it out here!",FB.ui({method:"feed",name:"Jollybee Online Judge - Rating Changes",caption:"Changes in "+t+"'s rating",description:c,link:"https://jollybeeoj.com/user/contest/"+e.contestData.contestId+"/rating?user="+t,message:"",picture:"jollybeeoj.com/images/logo-med.png"},function(e){})},e.loadFlagData=function(){var t=s.getCookie("flaggedCell_"+o.contestId);void 0===t||null===t||""===t?e.flaggedCell={}:e.flaggedCell=JSON.parse(t)},e.switchFlagData=function(t,n){e.flaggedCell.hasOwnProperty(t)||(e.flaggedCell[t]=!1),e.flaggedCell[t]=!e.flaggedCell[t],console.log(e.flaggedCell),s.setCookie("flaggedCell_"+o.contestId,JSON.stringify(e.flaggedCell),e.contestData.endTime-(new Date).getTime()+2592e5,""),e.flaggedCell[t]?$(n).css("color","rgba(0,0,0,0.4)"):$(n).css("color","")},e.loadContestProblem=function(n,r){t.post("/problem/contest/"+o.contestId).success(function(t){e.contestProblems=t,""!==e.contestProblems&&null!==e.contestProblems&&void 0!==e.contestProblems&&e.contestProblems.sort(function(e,t){return e.problemCode<t.problemCode?-1:e.problemCode>t.problemCode?1:0}),n&&n(r)}).error(function(e){console.log("error"),console.log(e)})},e.editorial.load=function(t){var n=new FormData;n.append("contestId",o.contestId),n.append("contestProblemId",t),$.ajax({url:"/announcement/contest/view/editorial",method:"POST",data:n,contentType:!1,processData:!1,cache:!1,success:function(o){e.$apply(function(){""===o&&(o="There is no editorial for this problem"),e.editorial.html=o,e.editorial.showingId=t})},error:function(e){console.log("error: "+e)}})},e.checkRevealEditorial=function(){t.post("/announcement/contest/editorial/public/check/"+o.contestId).success(function(t){e.allowRevealEditorial=t}).error(function(e){console.log("error: "+e)})},e.loadContestData=function(n){return s.isEmptyObject(e.contestData)===!1?void(n&&n()):void t.post("/announcement/contest/view/"+o.contestId).success(function(t){e.contestData=t,$("head > title").remove();var o;-1!==r.path().indexOf("/about")?o="About":-1!==r.path().indexOf("/problem")?o="Problem":-1!==r.path().indexOf("/textsubmission")?o="Submit":-1!==r.path().indexOf("/judgestatus")?o="Judge Status":-1!==r.path().indexOf("/clarification")?o="Clarification":-1!==r.path().indexOf("/scoreboard")?o="Scoreboard":-1!==r.path().indexOf("/rating")?o="Rating Changes":-1!==r.path().indexOf("/editorial")&&(o="Editorial"),$("head").append("<title>Contest - "+e.contestData.title+(""!==o&&void 0!==o&&null!==o?" - "+o:"")+"</title>"),e.loadContestLanguage(),n&&n()}).error(function(e){console.log("error"),console.log(e)})},e.loadContestLanguage=function(){t.post("/submission/view/language/"+o.contestId).success(function(t){e.contestData.languages=t}).error(function(e){console.log("error"),console.log(e)})},e.refreshContestProblemPath=function(){for(var t in e.contestProblems){var n=e.contestProblems[t].problemId;if(e.allowRevealProblemToPublic!==!0){if("Dummy User"!==e.userStatusInContest&&"Special Privileged User"!==e.userStatusInContest&&"Contestant"!==e.userStatusInContest)break;e.contestProblemPath[n]="/user/contest/"+o.contestId+"/problem/"+n}else e.contestProblemPath[n]="/user/contest/"+o.contestId+"/problem/"+n}},e.loadScoreboardData=function(){e.flag_runner_tool=void 0!==o.flag,e.flag_runner_tool&&e.loadFlagData(),t.post("/problem/contest/"+o.contestId).success(function(t){e.contestProblems=t,null!==e.contestProblems&&void 0!==e.contestProblems&&""!==e.contestProblems&&e.contestProblems.sort(function(e,t){return e.problemCode<t.problemCode?-1:e.problemCode>t.problemCode?1:0}),e.refreshContestProblemPath(),e.loadScoreboard()}).error(function(e){console.log("error"),console.log(e)})},e.checkUserStatusInContest=function(){var t=new FormData;t.append("contestId",o.contestId),$.ajax({type:"POST",url:"/announcement/contest/user_status/check",data:t,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.userStatusInContest=t,e.refreshContestProblemPath()})},error:function(e){console.log("error : "+e)}})},e.registerContest=function(){e.isWorking=!0;var t=new FormData;t.append("contestId",o.contestId),$.ajax({type:"POST",url:"/user/contest/register",data:t,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){alert(t),e.isWorking=!1,e.checkUserStatusInContest()})},error:function(t){e.isWorking=!1,console.log("error"),console.log(t)}})},e.checkAllowRevealFullScoreboard=function(){t.post("/announcement/contest/scoreboard/full/check/"+o.contestId).success(function(t){(t===!0||t===!1)&&(e.allowRevealFullScoreboard=t),e.refreshContestProblemPath()}).error(function(e){console.log("error "+e)})},e.loadScoreboard=function(){-1!==r.url().indexOf("scoreboard")&&e.loadContestData(function(){t.post("/announcement/contest/view/scoreboard/"+o.contestId,{showDummy:e.scoreboardShowDummy,showFull:e.scoreboardShowFull,time:e.scoreboardLastUpdateTime}).success(function(t){if(null===t||"null"===t||void 0===t||"undefined"===t||""===t)return clearTimeout(e.updateContestScoreboardTimeout),void(e.updateContestScoreboardTimeout=setTimeout(function(){e.loadScoreboard()},2e4));e.scoreboardData=t.value,e.scoreboardLastUpdateTime=t.key;for(var o=!1,n=0;n<e.contestProblems.length;n++){var r=-1,a=-1,s=e.contestProblems[n].problemId;o||(e.scoreboardZeroPointRank=0);for(var i=0;i<e.scoreboardData.length;i++)if(e.scoreboardData[i].acceptedTime.hasOwnProperty(s)&&null!==e.scoreboardData[i].acceptedTime[s]&&(e.scoreboardData[i].acceptedTime[s]<r||-1===r)&&(r=e.scoreboardData[i].acceptedTime[s],-1!==a&&(e.scoreboardData[a].cell[s].firstAc=!1),a=i,e.scoreboardData[i].cell[s].firstAc=!0),!o){var c=e.scoreboardData[i].username.indexOf("]");-1!==c&&(e.scoreboardData[i].username=e.scoreboardData[i].username.substr(c+1)),0!==e.scoreboardData[i].score&&(e.scoreboardZeroPointRank=i+1)}o||e.scoreboardZeroPointRank++,o=!0}if(!o){e.scoreboardZeroPointRank=0;for(var n=0;n<e.scoreboardData.length;n++){var c=e.scoreboardData[n].username.indexOf("]");-1!==c&&(e.scoreboardData[n].username=e.scoreboardData[n].username.substr(c+1)),0!==e.scoreboardData[n].score&&(e.scoreboardZeroPointRank=n+1)}e.scoreboardZeroPointRank++}var l="";l+="<thead><tr class='table table-hover' id='dataTable'>",l+="<td class='tableHeader anim:position'>Rank</td>",l+="<td class='tableHeader anim:id'>Name</td>",l+="<td class='tableHeader'>Solved</td>",l+="<td class='tableHeader'>Time Penalty</td>";for(var n=0;n<e.contestProblems.length;n++){var u=e.contestProblemPath[e.contestProblems[n].problemId];l+="<td class='tableHeader'><a class='problemScoreboardLink' "+(void 0===u||"undefined"===u||null===u||"null"===u||""===u?"":" href='"+u+"' ")+" data-toggle='tooltip' data-placement='top' data-original-title='"+e.contestProblems[n].title+"'>"+e.contestProblems[n].problemCode+"</a></td>"}l+="</tr></thead><tbody>";for(var n=0;n<e.scoreboardData.length;n++){l+="<tr>";var t=e.scoreboardData[n];l+=t.score>0?"<td><center><span class='scoreboardCellWrapper'>"+(n+1)+"</span></center></td>":"<td><center><span class='scoreboardCellWrapper'>"+e.scoreboardZeroPointRank+"</span></center></td>",l+="<td style='text-align:left'><span class='scoreboardCellWrapper' style='padding-left:8px; padding-right:8px;'><a onmouseover='addHoverCard_username(this, \""+t.username+"\")' onmouseleave='removeHoverCard()' href='/user/view/"+t.username+"' target='_blank' class='username' style='color:"+t.ratingColor+"'>"+t.username+"</a>"+(""!==t.description?"<span class='scoreboardUserDescription'><br>"+t.description+"</span>":"")+"</span></td>",l+="<td><center><span class='scoreboardCellWrapper'>"+t.score+"</span></center></td>",l+="<td><center><span class='scoreboardCellWrapper'>"+t.penalty+"</span></center></td>";for(var i=0;i<e.contestProblems.length;i++){var d=e.contestProblems[i],m=t.cell[d.problemId];if(l+="<td class='scoreboardCellData' style='min-width:50px;'><center style='display:table; width:100%;'><span class='scoreboardCellWrapper' style='"+(void 0===m?"background-color:white;":m.accepted?"background-color:#80FF80;":"background-color:#FF8080")+"'>",void 0!==t.cell[d.problemId]&&(l+="<p style='margin:0px; text-align: center;'>",l+=m.totalAttempt,m.firstAc&&(l+=" <span class='glyphicon glyphicon-king' style='color:chocolate; font-weight:bold;'></span>"),l+="<br/>",m.accepted&&(l+="<small>"+e.getDiffAccTime(t.acceptedTime[d.problemId])+"</small>"),e.flag_runner_tool&&m.accepted)){var p=t.username+"-"+d.problemId;l+='<span class="scoreboardFlag" onclick=\'angular.element(this).scope().switchFlagData("'+p+"\", this);'><span id='"+p+"' class='glyphicon glyphicon-flag' style='vertical-align:middle; "+(e.flaggedCell[p]?"color: rgba(0,0,0,0.4);":"")+"'></span></center>"}l+="</span></center></td>"}l+="</tr>"}l+="</tbody>",l="<table id='hiddenTableScoreData' class='table' style='white-space:nowrap; display: none;'>"+l+"</table>",""!==$("#tableScoreData").html()?($("#scoreboardContainer").append(l),$("#tableScoreData").rankingTableUpdate("#hiddenTableScoreData",{duration:[750,100,750,100,750],animationSettings:{up:{left:0,backgroundColor:"#CCFFCC"},down:{left:0,backgroundColor:"#FFCCCC"},fresh:{left:0,backgroundColor:"#CCFFCC"},drop:{left:0,backgroundColor:"#FFCCCC"}}}),$("#hiddenTableScoreData").attr("id","tableScoreData")):$("#tableScoreData").html(l),clearTimeout(e.updateContestScoreboardTimeout),e.updateContestScoreboardTimeout=setTimeout(function(){e.loadScoreboard()},2e4)}).error(function(e){console.log("error"),console.log(e)})})},e.toggleScoreboardShowFull=function(){e.scoreboardShowFull=!e.scoreboardShowFull,e.scoreboardLastUpdateTime=-1,e.loadScoreboard()},e.toggleScoreboardShowDummy=function(){e.scoreboardShowDummy=!e.scoreboardShowDummy,e.scoreboardLastUpdateTime=-1,e.loadScoreboard()},e.getDiffAccTime=function(t){var o=(t-e.contestData.startTime)/1e3,n=Math.floor(o/3600),r=Math.floor(o%3600/60);return n=10>n?"0"+n:""+n,r=10>r?"0"+r:""+r,n+":"+r},e.parseDateReadable=function(t){if(t){var o=new Date(t);return("0"+o.getDate()).slice(-2)+"-"+e.monthNames[o.getMonth()]+"-"+o.getFullYear()+" "+("0"+o.getHours()).slice(-2)+":"+("0"+o.getMinutes()).slice(-2)+":"+("0"+o.getSeconds()).slice(-2)}},e.getCurrentGlobalTimestamp=function(){e.currTime=l.currentServerTime(),(void 0===e.currTime||NaN===e.currTime)&&setTimeout(function(){e.getCurrentGlobalTimestamp()},1e4)},e.updateCountDown=function(){if(e.currTime+=1e3,e.contestData.startTime>e.currTime?(e.cdMsg="before start",e.targetTime=e.contestData.startTime):e.contestData.endTime>=e.currTime?(e.cdMsg="time remaining",e.targetTime=e.contestData.endTime):e.contestData.endTime<e.currTime&&(e.countDownTime="--:--:--",e.cdMsg="Contest has finished",e.targetTime=void 0,e.stopCountDown()),void 0!==e.targetTime){var t=Math.abs(e.currTime-e.targetTime),o=new Date(t);o=new Date(o.getTime()+6e4*o.getTimezoneOffset()),e.countDownTime=Math.floor(t/36e5)+" : "+("0"+o.getMinutes()).slice(-2)+" : "+("0"+o.getSeconds()).slice(-2)}},e.synchronizeCurrentTime=function(){e.getCurrentGlobalTimestamp(),e.currTimeSynchronizePromise=a(e.getCurrentGlobalTimestamp,6e5)},e.startCountDown=function(t){e.countDownPromise=a(e.updateCountDown,1e3)},e.stopCountDown=function(){a.cancel(e.countDownPromise),a.cancel(e.currTimeSynchronizePromise)}}]),angular.module("helperModule",[]).service("Helper",Helper),angular.module("mainModule",["userModule","announcementModule","problemModule","navModule","submissionModule","contestModule","clarificationModule","ngRoute"]).config(["$locationProvider","$httpProvider","$routeProvider",function(e,t,o){configLocation(e),configHttp(t),configRoute(o)}]).run(["$rootScope","$route","$routeParams","ServerTimeSvc",function(e,t,o,n){n.init(),e.$on("$routeChangeSuccess",function(){if("function"==typeof t.current.title?document.title=t.current.title(o):document.title=t.current.title,void 0!==t.current.meta.property&&null!==t.current.meta.property)for(var e in t.current.meta.property)$('meta[property="'+e+'"]').remove(),$("head").append('<meta property="'+e+'" content="'+t.current.meta.property[e]+'"/>');if(void 0!==t.current.meta.name&&null!==t.current.meta.name)for(var e in t.current.meta.name)$('meta[name="'+e+'"]').remove(),$("head").append('<meta name="'+e+'" content="'+t.current.meta.name[e]+'"/>')})}]),angular.module("navModule",["helperModule","userModule"]).controller("NavCtrl",["$scope","$http","$location",function(e,t,o){e.navIndex=-1,e.setIndex=function(t){e.navIndex=t},e.refreshHeaderNav=function(t,n){e.navIndex=-1;var r=o.path();"/"===r?e.navIndex=0:-1!==r.indexOf("/problem")?e.navIndex=1:-1!==r.indexOf("/submission")?e.navIndex=2:-1!==r.indexOf("/user/contest")?e.navIndex=3:-1!==r.indexOf("/user/rank")?e.navIndex=4:-1!==r.indexOf("/user/about")?e.navIndex=5:-1!==r.indexOf("/user/tools")&&(e.navIndex=6)},e.$on("$routeChangeSuccess",e.refreshHeaderNav)}]).controller("ToolsNavCtrl",["$scope","$http","$location","UserDataSvc","Helper",function(e,t,o,n,r){e.cookieName="ToolIndex",e.currentTool="",e.authorizedTools=[],e.toolsName=["Add Problem","Update Problem","Add Contest","Update Contest","Add Problem To Contest","Update Problem In Contest","Manage User In Contest","Add New Role","Edit Role's Power","Change User's Role","Add Announcement","Update Announcement","Rejudge Submission","Manage Coin","Manage Proposed Problem"],e.pages=["/static/html/includes/tools/add_problem.html","/static/html/includes/tools/update_problem.html","/static/html/includes/tools/add_contest.html","/static/html/includes/tools/update_contest.html","/static/html/includes/tools/add_contest_problem.html","/static/html/includes/tools/update_contest_problem.html","/static/html/includes/tools/manage_contest_user.html","/static/html/includes/tools/add_new_role.html","/static/html/includes/tools/edit_role_power.html","/static/html/includes/tools/change_user_role.html","/static/html/includes/tools/add_announcement.html","/static/html/includes/tools/update_announcement.html","/static/html/includes/tools/rejudge_submission.html","/static/html/includes/tools/manage_coin.html","/static/html/includes/tools/manage_proposed_problem.html"],e.currentPage="/static/html/includes/empty.html",e.switchTools=function(t){var o=e.toolsName.indexOf(t);-1!==o&&(e.currentTool=t,e.currentPage=e.pages[o],r.setCookie(e.cookieName,o))},e.getLastTool=function(){if(void 0!==n.getData()&&n.getData().hasPower){var t=r.getCookie(e.cookieName);void 0!==t?e.switchTools(e.toolsName[t]):e.switchTools(e.toolsName[0])}},e.getAuthorizedTools=function(){t.post("user/tools").success(function(t){e.authorizedTools=t}).error(function(e){console.log("error"),console.log(e)})},e.getLastTool()}]).controller("ContestNavCtrl",["$scope","$http","$location","$routeParams","UserDataSvc","Helper",function(e,t,o,n,r,a){e.currContestId=n.contestId,e.contestMenuIndex=-1,e.cookieName="ContestIndex",e.pages=["/about","/problem","/judgestatus","/clarification","/scoreboard","/rating","/editorial"],e.currentPage="",e.getContestMenu=function(){for(var t=o.path(),n=0;n<e.pages.length;n++)if(-1!==t.indexOf(e.pages[n])){e.contestMenuIndex=n,1===n&&t.indexOf(e.pages[n])!==t.length-e.pages[n].length&&(e.contestMenuIndex=7);break}},e.getContestMenu()}]),angular.module("problemModule",["helperModule","submissionModule","userModule"]).filter("elapsedTime",function(){var e=function(e,t){return e>1&&(t+="s"),e+" "+t+" ago"};return function(t){return NaN===t?"":(t=Math.floor(t/1e3),60>t?e(t,"second"):(t=Math.floor(t/60),60>t?e(t,"minute"):(t=Math.floor(t/60),24>t?e(t,"hour"):(t=Math.floor(t/24),365>t?e(t,"day"):(t=Math.floor(t/365),e(t,"year"))))))}}).directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(t,o,n){var r=e(n.fileModel),a=r.assign;o.bind("change",function(){t.$apply(function(){a(t,o[0].files[0])})})}}}]).directive("fileModelR",["$parse",function(e){return{restrict:"A",link:function(t,o,n){var r=e(n.fileModelR),a=r.assign;o.bind("change",function(){t.$apply(function(){a(t,o[0].files[0])}),t.addProblemImage()})}}}]).filter("textareaMentionFilter",function(){return function(e,t){var o="";if(void 0===e||null===e)return o;for(var n=0;n<e.length;n++)o+="&"===e[n]?"&amp;":"<"===e[n]?"&lt;":">"===e[n]?"&gt;":"\n"===e[n]?"<br>&#8203;":e[n];if(o=o.replace(/(http[s]?:\/\/[A-Za-z0-9-._~:\/?#\[\]@!$&'()*+,;=]*)/g,'<a href="$1" target="_blank">$1</a>'),void 0===t.scope[t.mentionArray]||null===t.scope[t.mentionArray])return o;for(var n=t.scope[t.mentionArray].length-1;n>=0;n--){var r=t.scope[t.mentionArray][n].username,a=t.scope[t.mentionArray][n].color,s=new RegExp("\\b"+r+"\\b","g"),i=o.replace(s,'<a onmouseover="addHoverCard_username(this, &quot;'+r+'&quot;)" onmouseleave="removeHoverCard()" href="/user/view/'+r+'" target="_blank" class="username" style="color:'+a+'">'+r+"</a>");o==i?t.scope[t.mentionArray].splice(n,1):o=i}return o}}).directive("textareaMention",function(){return{require:"ngModel",scope:!1,link:function(e,t,o,n){var r=function(e,t,o){var n=e.html(),r=o;void 0===n&&(n=""),"\n"===n[o]&&r++;var a=n.slice(r);n=n.slice(0,r),n=[n,t,a].join(""),e.html(n)},a=function(){e.$apply(function(){var n,a=o.displayModel,s=$(o.mentionDisplay+"Caret");n="true"===o.useParentScope?e.$parent:e,void 0===n[a]&&(n[a]="");for(var i="",c=0;c<n[a].length;c++)i+="\n"===n[a][c]?"\n":" ";s.html(i),$("blink").remove();var l=getCaretPosition(t[0]);0>l-1||"\n"===n[a][l-1]?r(s,"<blink style='left:3px; position:absolute;'>|</blink>",l):r(s,"<blink>|</blink>",l-1);for(var u=t.val(),d="",c=l-1;c>=0&&(u[c]>="a"&&u[c]<="z"||u[c]>="A"&&u[c]<="Z"||u[c]>="0"&&u[c]<="9");c--)d=u[c]+d;var m=o.textareaMention;if("@"!==u[c])return void(e.autocomplete.mention[m]="");for(var c=l;c<u.length&&(u[c]>="a"&&u[c]<="z"||u[c]>="A"&&u[c]<="Z"||u[c]>="0"&&u[c]<="9");c++)d+=u[c];e.autocomplete.mention[m]=d})};t.bind("input",function(n){e.$apply(function(){var n;n="true"===o.useParentScope?e.$parent:e;var r=o.displayModel;n[r]=t.val()}),a()}),t.bind("keydown keyup",function(n){e.$apply(function(){var r=$(o.typeaheadTextareaId)[0].attributes.getNamedItem("aria-owns").value;if(40===n.keyCode&&angular.element("ul[typeahead-popup][id='"+r+"']").scope().matches.length>0)n.preventDefault(),"keydown"===n.type&&(angular.element("ul[typeahead-popup][id='"+r+"']").scope().activeIdx++,angular.element("ul[typeahead-popup][id='"+r+"']").scope().activeIdx%=angular.element("ul[typeahead-popup][id='"+r+"']").scope().matches.length);else if(38===n.keyCode&&angular.element("ul[typeahead-popup][id='"+r+"']").scope().matches.length>0)n.preventDefault(),"keydown"===n.type&&(angular.element("ul[typeahead-popup][id='"+r+"']").scope().activeIdx--,angular.element("ul[typeahead-popup][id='"+r+"']").scope().activeIdx<0&&(angular.element("ul[typeahead-popup][id='"+r+"']").scope().activeIdx=angular.element("ul[typeahead-popup][id='"+r+"']").scope().matches.length-1));else if(13===n.keyCode&&(angular.element("ul[typeahead-popup][id='"+r+"']").scope().matches.length>0||void 0!==n.typeaheadMatchModel)&&(n.preventDefault(),"keydown"===n.type)){var a;a=angular.element("ul[typeahead-popup][id='"+r+"']").scope().matches.length>0?angular.element("ul[typeahead-popup][id='"+r+"']").scope().matches[angular.element("ul[typeahead-popup][id='"+r+"']").scope().activeIdx].model:n.typeaheadMatchModel;for(var s,i,c=a.username,l=t.val(),u=getCaretPosition(t[0]),s=u-1;s>=0&&(l[s]>="a"&&l[s]<="z"||l[s]>="A"&&l[s]<="Z"||l[s]>="0"&&l[s]<="9");s--);for(var i=u;i<l.length&&(l[i]>="a"&&l[i]<="z"||l[i]>="A"&&l[i]<="Z"||l[i]>="0"&&l[i]<="9");i++);s-1>=0&&(l[s-1]>="a"&&l[s-1]<="z"||l[s-1]>="A"&&l[s-1]<="Z"||l[s-1]>="0"&&l[s-1]<="9")&&(c=" "+c);var d=l.slice(i);l=l.slice(0,s),t.val([l,c,d].join("")),setCaretPosition(t[0],l.length+c.length);var m,p=o.displayModel;m="true"===o.useParentScope?e.$parent:e,m[p]=t.val();var g=o.mentionArrayModel;(void 0===m[g]||null===m[g])&&(m[g]=[]);for(var h=!1,s=0;s<m[g].length;s++)if(a.username==m[g][s].username){h=!0;break}h||m[g].push({username:a.username,color:a.ratingColor})}}),a()}),t.bind("blur",function(e){$("blink").remove()}),t.bind("mouseup",function(e){a()})}}}).directive("triggerTypeaheadMention",function(){function e(e,t,o,n){e.$watch(function(){return e.autocomplete.mention[o.triggerTypeaheadMention]},function(){n.$setViewValue(e.autocomplete.mention[o.triggerTypeaheadMention])})}return{link:e,require:"ngModel",restrict:"A",scope:!1}}).controller("ProblemCtrl",["$scope","$http","$location","$routeParams","$window","UserDataSvc","Helper","$sce",function(e,t,o,n,r,a,s,i){e.addHoverCard_username=addHoverCard_username,e.removeHoverCard=removeHoverCard,e.userDataShared={},e.autocomplete={},e.isWorking=!1,e.isShowingHidden=!1,e.numOfProblemsToShow=30,e.currPageNum=1,e.totalPage=0,e.totalProblems=0,e.problemData={defaultCheckerSpec:"ignoreMultipleWhitespaces"},e.contestData={},e.problems={},e.latestProblemComment={},e.bookmarkProblem={},e.visibleProblem={sort:{column:"id",order:"asc"},pageType:"all"},e.hiddenProblems={},e.pages=[],e.checkerMsg="",e.msg="",e.isContest=!1,e.imageIds=[],e.grantedUsers=[],e.userStatusInContest="",e.contestMenuProblemId="",e.allowRevealProblemToPublic=!1,e.contestProblemPath={},e.browseProblemByContestStructure=[],e.problemByContestTreeAdjList={},e.problemByContestOn={},e.problemByContestParent={},e.$watch(function(){return a.getData()},function(){e.userDataShared=a.getData()}),e.prevPage=function(){e.currPageNum>1&&(e.currPageNum--,e.populateVisibleProblems())},e.nextPage=function(){e.currPageNum<e.totalPage&&(e.currPageNum++,e.populateVisibleProblems())},e.getAutocompleteUsername=function(e){return""!==e&&void 0!==e&&null!==e?t.post("/user/autocomplete",{pattern:e}).then(function(e){return e.data}):void 0},e.getBrowseProblemByContestStructure=function(){e.browseProblemByContestStructure=s.getBrowseProblemByContestStructure();var t=[],o=0,n={},r=function(a,s,i){for(var c in a){o++,e.problemByContestOn[o]=!1;var l=a[c],u={};u.key=c,u.value=l,u.id=o,u.depth=s,u.isLeaf=!0,u.pad=16+16*s+"px",(void 0===n[i]||null===n[i]||""===n[i])&&(n[i]=[]),n[i].push(o),e.problemByContestParent[o]=i,angular.isObject(l)&&(u.isLeaf=!1),t.push(u),angular.isObject(l)&&r(l,s+1,o)}};r(e.browseProblemByContestStructure,0,0),e.problemByContestOn[0]=!0,e.problemByContestTreeAdjList=n,e.browseProblemByContestStructure=t},e.getLatestProblemComment=function(){t.post("/problem/comment/latest").success(function(t){e.latestProblemComment=t}).error(function(e){console.log("error"),console.log(e)})},e.clickBrowseProblemByContest=function(t){var o=function(t){if(e.problemByContestOn[t]!==!1&&void 0!==e.problemByContestTreeAdjList[t]&&null!==e.problemByContestTreeAdjList[t]&&""!==e.problemByContestTreeAdjList[t]){e.problemByContestOn[t]=!1;for(var n=0;n<e.problemByContestTreeAdjList[t].length;n++){var r=e.problemByContestTreeAdjList[t][n];e.problemByContestOn[r]&&o(r)}}};e.problemByContestOn[t]?o(t):e.problemByContestOn[t]=!0},e.bookmarkProblem.add=function(e){t.post("/problem/bookmark/add",{problemId:e.problemId}).success(function(t){t&&(e.isBookmarked=!0)}).error(function(e){console.log("error: "+e)})},e.bookmarkProblem.remove=function(e){t.post("/problem/bookmark/remove",{problemId:e.problemId}).success(function(t){t&&(e.isBookmarked=!1)}).error(function(e){console.log("error: "+e)})},e.visibleProblem.changePageType=function(t){e.visibleProblem.pageType=t,e.currPageNum=1,e.populateVisibleProblems()},e.checkUserStatusInContest=function(){var t=new FormData;t.append("contestId",n.contestId),$.ajax({type:"POST",url:"/announcement/contest/user_status/check",data:t,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.userStatusInContest=t,e.refreshContestProblemPath()})},error:function(e){console.log("error : "+e)}})},e.checkAllowRevealProblemToPublic=function(){t.post("/announcement/contest/problem/public/check/"+n.contestId).success(function(t){(t===!0||t===!1)&&(e.allowRevealProblemToPublic=t),e.refreshContestProblemPath()}).error(function(e){console.log("error "+e)})},e.truncateProblemTitle=function(t){for(var o=0;o<e.problems.length;o++)e.problems[o].title.length>t&&(e.problems[o].title=e.problems[o].title.substr(0,t)+"...")},e.populateVisibleProblems=function(o,n){if(null===o||void 0===o||isNaN(o)||(e.currPageNum=o),void 0!==n&&null!==n)e.visibleProblem.sort.column===n?"asc"===e.visibleProblem.sort.order?e.visibleProblem.sort.order="desc":e.visibleProblem.sort.order="asc":(e.visibleProblem.sort.column=n,e.visibleProblem.sort.order="asc"),s.setCookie("PASC",JSON.stringify(e.visibleProblem.sort),7776e6,"");else{var r=s.getCookie("PASC");void 0!==r&&null!==r&&""!==r&&(e.visibleProblem.sort=JSON.parse(r))}t.post("problem/count",{bookmarks:"bookmarks"===e.visibleProblem.pageType}).success(function(t){e.totalPage=Math.ceil(t/e.numOfProblemsToShow),e.pages=s.getPageArr(e.currPageNum,e.totalPage)}).error(function(e){console.log("error: "+e)}),t.post("problem/view/simple/"+e.currPageNum,{sortColumn:e.visibleProblem.sort.column,sortOrder:e.visibleProblem.sort.order,bookmarks:"bookmarks"===e.visibleProblem.pageType}).success(function(t){e.visibleProblem.data=t,e.problems=t}).error(function(e){console.log("error : "+e)})},e.populateHiddenProblems=function(){t.post("problem/view/hidden").success(function(t){e.hiddenProblems=t,e.problems=e.hiddenProblems}).error(function(e){console.log("error : "+e)})},e.toggleHiddenProblem=function(){e.isShowingHidden=!e.isShowingHidden,e.isShowingHidden?e.populateHiddenProblems():e.populateVisibleProblems()},e.refreshContestProblemPath=function(){for(var t in e.problems){var o=e.problems[t].problemId;if(e.allowRevealProblemToPublic!==!0){if("Dummy User"!==e.userStatusInContest&&"Special Privileged User"!==e.userStatusInContest&&"Contestant"!==e.userStatusInContest)break;e.contestProblemPath[o]="/user/contest/"+n.contestId+"/problem/"+o}else e.contestProblemPath[o]="/user/contest/"+n.contestId+"/problem/"+o}},e.addProblem=function(){e.isWorking=!0,e.msg="Processing...","exactMatch"===e.problemData.defaultCheckerSpec&&(e.problemData.defaultCheckerExactMatch=!0);var t=new FormData;angular.forEach(e.problemData,function(e,t){this.append(t,e)},t),t.append("testcaseInput",e.testcaseInput),t.append("testcaseOutput",e.testcaseOutput),t.append("testcaseChecker",e.testcaseChecker),(void 0===e.problemData.hint||null===e.problemData.hint)&&t.append("hint",""),(void 0===e.problemData.descriptions.EN||null===e.problemData.descriptions.EN.problem)&&t.append("descriptions.EN.problem",""),(void 0===e.problemData.descriptions.VI||null===e.problemData.descriptions.VI.problem)&&t.append("descriptions.VI.problem",""),(void 0===e.problemData.descriptions.EN||null===e.problemData.descriptions.EN.input)&&t.append("descriptions.EN.input",""),(void 0===e.problemData.descriptions.VI||null===e.problemData.descriptions.VI.input)&&t.append("descriptions.VI.input",""),(void 0===e.problemData.descriptions.EN||null===e.problemData.descriptions.EN.output)&&t.append("descriptions.EN.output",""),(void 0===e.problemData.descriptions.VI||null===e.problemData.descriptions.VI.output)&&t.append("descriptions.VI.output",""),(void 0===e.problemData.descriptions.EN||null===e.problemData.descriptions.EN.note)&&t.append("descriptions.EN.note",""),(void 0===e.problemData.descriptions.VI||null===e.problemData.descriptions.VI.note)&&t.append("descriptions.VI.note",""),$.ajax({type:"POST",url:"/problem/tools/add",data:t,
contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.msg=t,e.isWorking=!1})},error:function(t){e.isWorking=!1,console.log("error"),console.log(t)}})},e.updateProblem=function(t){e.msg="Processing...",e.isWorking=!0,"exactMatch"===e.problemData.defaultCheckerSpec&&(e.problemData.defaultCheckerExactMatch=!0);var o=new FormData;o.append("problemId",t),angular.forEach(e.problemData,function(e,t){this.append(t,e)},o),o.append("testcaseInput",e.testcaseInput),o.append("testcaseOutput",e.testcaseOutput),o.append("testcaseChecker",e.testcaseChecker),(void 0===e.problemData.hint||null===e.problemData.hint)&&o.append("hint",""),(void 0===e.problemData.descriptions.EN.problem||null===e.problemData.descriptions.EN.problem)&&o.append("descriptions.EN.problem",""),(void 0===e.problemData.descriptions.VI.problem||null===e.problemData.descriptions.VI.problem)&&o.append("descriptions.VI.problem",""),(void 0===e.problemData.descriptions.EN.input||null===e.problemData.descriptions.EN.input)&&o.append("descriptions.EN.input",""),(void 0===e.problemData.descriptions.EN.input||null===e.problemData.descriptions.EN.input)&&o.append("descriptions.EN.input",""),(void 0===e.problemData.descriptions.EN.output||null===e.problemData.descriptions.EN.output)&&o.append("descriptions.EN.output",""),(void 0===e.problemData.descriptions.EN.output||null===e.problemData.descriptions.EN.output)&&o.append("descriptions.EN.output",""),(void 0===e.problemData.descriptions.EN.note||null===e.problemData.descriptions.EN.note)&&o.append("descriptions.EN.note",""),(void 0===e.problemData.descriptions.VI.note||null===e.problemData.descriptions.VI.note)&&o.append("descriptions.VI.note",""),$.ajax({type:"POST",url:"/problem/tools/update",data:o,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.msg=t,e.isWorking=!1,e.updateGrantedUser()})},error:function(t){e.isWorking=!1,console.log("error"),console.log(t)}})},e.updateContestProblem=function(){e.msg="Processing...",e.isWorking=!0,null!==e.problemData.editorial&&void 0!==e.problemData.editorial&&""!==e.problemData.editorial&&t.post("/announcement/tools/editorial/add",{html:e.problemData.editorial,contestProblemId:e.problemData.problemId,contestId:e.contestData.contestId}).success(function(e){}).error(function(e){console.log("error: "+e)}),"exactMatch"===e.problemData.defaultCheckerSpec&&(e.problemData.defaultCheckerExactMatch=!0);var o=new FormData;angular.forEach(e.problemData,function(e,t){this.append(t,e)},o),o.append("editorial",null),o.append("contestId",e.contestData.contestId),o.append("contestProblemId",e.problemData.problemId),o.append("testcaseInput",e.testcaseInput),o.append("testcaseOutput",e.testcaseOutput),o.append("testcaseChecker",e.testcaseChecker),(void 0===e.problemData.descriptions.EN.problem||null===e.problemData.descriptions.EN.problem)&&o.append("descriptions.EN.problem",""),(void 0===e.problemData.descriptions.VI.problem||null===e.problemData.descriptions.VI.problem)&&o.append("descriptions.VI.problem",""),(void 0===e.problemData.descriptions.EN.input||null===e.problemData.descriptions.EN.input)&&o.append("descriptions.EN.input",""),(void 0===e.problemData.descriptions.EN.input||null===e.problemData.descriptions.EN.input)&&o.append("descriptions.EN.input",""),(void 0===e.problemData.descriptions.EN.output||null===e.problemData.descriptions.EN.output)&&o.append("descriptions.EN.output",""),(void 0===e.problemData.descriptions.EN.output||null===e.problemData.descriptions.EN.output)&&o.append("descriptions.EN.output",""),(void 0===e.problemData.descriptions.EN.note||null===e.problemData.descriptions.EN.note)&&o.append("descriptions.EN.note",""),(void 0===e.problemData.descriptions.VI.note||null===e.problemData.descriptions.VI.note)&&o.append("descriptions.VI.note",""),$.ajax({type:"POST",url:"/problem/tools/contest/update",data:o,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.msg=t,e.isWorking=!1})},error:function(t){e.isWorking=!1,console.log("error"),console.log(t)}})},e.loadAuthorizedProblem=function(){$.ajax({type:"POST",url:"/problem/tools/data/problem",contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.problems=t})},error:function(t){e.isWorking=!1,console.log("error"),console.log(t)}})},e.deleteContestChecker=function(t){var o=new FormData;o.append("contestProblemId",t),o.append("contestId",e.contestData.contestId),e.isWorking=!0,$.ajax({type:"POST",url:"/problem/tools/contest/delete_checker",data:o,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.isWorking=!1,e.checkerMsg=t})},error:function(t){e.isWorking=!1,console.log("error"),console.log(t)}})},e.deleteChecker=function(t){var o=new FormData;o.append("problemId",t),e.isWorking=!0,$.ajax({type:"POST",url:"/problem/tools/delete_checker",data:o,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.isWorking=!1,e.checkerMsg=t})},error:function(t){e.isWorking=!1,console.log("error"),console.log(t)}})},e.loadContestProblem=function(o,r){e.problems=e.$parent.contestProblems,t.post("/problem/contest/"+n.contestId).success(function(t){e.problems=t,""!==e.problems&&null!==e.problems&&void 0!==e.problems&&e.problems.sort(function(e,t){return e.problemCode<t.problemCode?-1:e.problemCode>t.problemCode?1:0}),void 0!==n.problemId&&(e.contestMenuProblemId=n.problemId),e.refreshContestProblemPath(),o&&o(r)}).error(function(e){console.log("error"),console.log(e)})},e.loadContestProblemByTools=function(o){t.post("/problem/tools/data/problem_contest",{contestId:o}).success(function(t){e.problems=t,e.problems.sort(function(e,t){return e.problemCode<t.problemCode?-1:e.problemCode>t.problemCode?1:0})}).error(function(e){console.log("error"),console.log(e)})},e.loadProblemData=function(o){e.loadAllProblemImages(o),e.loadGrantedUser(o),e.msg="",t.post("/problem/tools/view/"+o).success(function(t){e.problemData=t,e.problemData.defaultCheckerExactMatch===!0?e.problemData.defaultCheckerSpec="exactMatch":e.problemData.defaultCheckerSpec="ignoreMultipleWhitespaces",delete e.problemData.defaultCheckerExactMatch}).error(function(e){console.log(e)})},e.loadAllProblemImages=function(o){t.post("/problem/tools/data/image",{problemId:o}).success(function(t){e.imageIds=t}).error(function(e){console.log("error"),console.log(e)})},e.loadContestProblemData=function(o){e.loadAllContestProblemImages(o),t.post("/problem/view/contest/"+o,{contestId:e.contestData.contestId}).success(function(t){e.problemData=t;var n=new FormData;n.append("contestProblemId",o),n.append("contestId",e.contestData.contestId),$.ajax({url:"/announcement/contest/view/editorial",method:"POST",data:n,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.problemData.editorial=t})},error:function(e){console.log("error: "+e)}}),e.problemData.defaultCheckerExactMatch===!0?e.problemData.defaultCheckerSpec="exactMatch":e.problemData.defaultCheckerSpec="ignoreMultipleWhitespaces",delete e.problemData.defaultCheckerExactMatch}).error(function(e){console.log(e)})},e.loadAllContestProblemImages=function(o){t.post("/problem/tools/data/contest/image",{problemId:o,contestId:e.contestData.contestId}).success(function(t){e.imageIds=t}).error(function(e){console.log("error"),console.log(e)})},e.addContestProblemImage=function(){var t=new FormData;t.append("contestId",e.contestData.contestId),t.append("problemId",e.problemData.problemId),t.append("imageFile",e.imageFile),e.isWorking=!0,$.ajax({type:"POST",url:"/problem/tools/contest/image/add",data:t,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.isWorking=!1,e.imageIds.push(t)})},error:function(t){e.isWorking=!1,console.log("error"),console.log(t)}})},e.addProblemImage=function(){if(void 0!==e.contestData.contestId&&null!==e.contestData.contestId)return void e.addContestProblemImage();var t=new FormData;t.append("problemId",e.problemData.problemId),t.append("imageFile",e.imageFile),e.isWorking=!0,$.ajax({type:"POST",url:"/problem/tools/image/add",data:t,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.isWorking=!1,e.imageIds.push(t)})},error:function(t){e.isWorking=!1,console.log("error"),console.log(t)}})},e.deleteContestProblemImage=function(t,o){var n=new FormData;n.append("contestId",e.contestData.contestId),n.append("imageId",t),e.isWorking=!0,$.ajax({type:"POST",url:"/problem/tools/contest/image/delete",data:n,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.isWorking=!1,e.imageIds.splice(o,1)})},error:function(t){e.isWorking=!1,console.log("error"),console.log(t)}})},e.deleteProblemImage=function(t,o){var n=new FormData;n.append("problemId",e.problemData.problemId),n.append("imageId",t),e.isWorking=!0,$.ajax({type:"POST",url:"/problem/tools/image/delete",data:n,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.isWorking=!1,e.imageIds.splice(o,1)})},error:function(t){e.isWorking=!1,console.log("error"),console.log(t)}})},e.fullImgPath=function(e){return"/problem/image/"+e},$("#inputUser").keyup(function(t){13===t.keyCode&&""!==$("#inputUser").val()&&e.$apply(function(){-1===$.inArray(e.autocomplete.grantedUser,e.grantedUsers)&&e.grantedUsers.push(e.autocomplete.grantedUser),e.autocomplete.grantedUser=""})}),$("#addImgBtn").click(function(){$("#imgInput").click()}),e.deleteGrantedUser=function(t){e.grantedUsers.splice(t,1)},e.loadGrantedUser=function(o){t.post("/problem/tools/data/special_privilege",{problemId:o}).success(function(t){e.grantedUsers=[];for(var o=0;o<t.length;o++)e.grantedUsers.push(t[o].username)}).error(function(e){console.log("error"),console.log(e)})},e.updateGrantedUser=function(){e.isWorking=!0;var t=new FormData;t.append("problemId",e.problemData.problemId),t.append("usernameList",e.grantedUsers),$.ajax({type:"POST",url:"/problem/tools/special_privilege/update",data:t,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.isWorking=!1}),"Success"!==t&&e.$apply(function(){e.grantMsg=", but "+t.toString()+" for updating granted user"})},error:function(t){e.isWorking=!1,console.log("error"),console.log(t)}})},e.loadAuthorizedContests=function(){t.post("/announcement/tools/contest/user/special_privilege").success(function(t){e.contests=t,e.contests.sort(function(e,t){return e.contestId<t.contestId?1:e.contestId>t.contestId?-1:0})}).error(function(e){console.log("error"),console.log(e)})},e.addContestProblem=function(){e.isWorking=!0,e.msg="Processing...","exactMatch"===e.problemData.defaultCheckerSpec&&(e.problemData.defaultCheckerExactMatch=!0);var t=new FormData;angular.forEach(e.problemData,function(e,t){this.append(t,e)},t),t.append("testcaseInput",e.testcaseInput),t.append("testcaseOutput",e.testcaseOutput),t.append("testcaseChecker",e.testcaseChecker),(void 0===e.problemData.descriptions.EN.problem||null===e.problemData.descriptions.EN.problem)&&t.append("descriptions.EN.problem",""),(void 0===e.problemData.descriptions.VI.problem||null===e.problemData.descriptions.VI.problem)&&t.append("descriptions.VI.problem",""),(void 0===e.problemData.descriptions.EN.input||null===e.problemData.descriptions.EN.input)&&t.append("descriptions.EN.input",""),(void 0===e.problemData.descriptions.EN.input||null===e.problemData.descriptions.EN.input)&&t.append("descriptions.EN.input",""),(void 0===e.problemData.descriptions.EN.output||null===e.problemData.descriptions.EN.output)&&t.append("descriptions.EN.output",""),(void 0===e.problemData.descriptions.EN.output||null===e.problemData.descriptions.EN.output)&&t.append("descriptions.EN.output",""),(void 0===e.problemData.descriptions.EN.note||null===e.problemData.descriptions.EN.note)&&t.append("descriptions.EN.note",""),(void 0===e.problemData.descriptions.VI.note||null===e.problemData.descriptions.VI.note)&&t.append("descriptions.VI.note",""),$.ajax({type:"POST",url:"/problem/tools/contest/add",data:t,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.msg=t,e.isWorking=!1})},error:function(t){e.isWorking=!1,console.log("error"),console.log(t)}})}}]).controller("ProblemDetailCtrl",["$scope","$http","$routeParams","$sce","$location","Helper","UserDataSvc","$timeout","ServerTimeSvc",function(e,t,o,n,r,a,s,i,c){e.currentServerTime=null,e.addHoverCard_username=addHoverCard_username,e.removeHoverCard=removeHoverCard,e.userDataShared={},e.problemDetails={},e.autocomplete={mention:{},pattern:{}},e.comments={show:!1,data:[],currentPage:1,totalPage:1,textAdd:"",textAddHTML:""},e.isWorking=!1,e.currentPage="prob_desc",e.editor=void 0,e.$watch(function(){return c.currentServerTime()},function(){e.currentServerTime=c.currentServerTime()}),e.$watch(function(){return s.getData()},function(){e.userDataShared=s.getData()}),e.$watch(),e.changePage=function(t){e.currentPage=t},e.parseToHTML=function(e){return a.parseToHTML(n,e)},e.getAutocompleteUsername=function(e){return""!==e&&void 0!==e&&null!==e?t.post("/user/autocomplete",{pattern:e}).then(function(e){return e.data}):void 0},e.comments.typeaheadOnSelectCallback=function(e,t,o,n,r){var a=jQuery.Event("keydown");a.which=13,a.keyCode=13,a.typeaheadMatchModel=e,setTimeout(function(){$(r).siblings(n).trigger(a)},100)},e.comments.prevPage=function(){e.comments.currentPage>1&&e.comments.currentPage--,e.comments.pages=a.getPageArr(e.comments.currentPage,e.comments.totalPage),e.comments.get(e.comments.currentPage)},e.comments.nextPage=function(){e.comments.currentPage<e.comments.totalPage&&e.comments.currentPage++,e.comments.pages=a.getPageArr(e.comments.currentPage,e.comments.totalPage),e.comments.get(e.comments.currentPage)},e.comments.toggle=function(){e.comments.show=!e.comments.show,e.comments.get(e.comments.currentPage)},e.comments.toggleEditing=function(o,n){if(e.comments.data[o].isEditing)if(n)e.comments.data[o].isEditing=!1,e["commentTextEditDisplay"+e.comments.data[o].problemCommentId]=e.comments.data[o].beforeEdit;else{if(!/\S/.test(e.comments.data[o].textEdit))return;t.post("/problem/comment/edit",{problemCommentId:e.comments.data[o].problemCommentId,newComment:e.comments.finalizeComment(e["commentTextEditDisplay"+e.comments.data[o].problemCommentId],e.comments.data[o].problemCommentId)}).success(function(t){t&&(e.comments.initComment(t),e.comments.data[o]=t,e.comments.data[o].isEditing=!1)}).error(function(e){console.log("error: "+e)})}else e.comments.data[o].isEditing=!0,e.comments.data[o].beforeEdit=e["commentTextEditDisplay"+e.comments.data[o].problemCommentId],e.comments.data[o].textEdit=e["commentTextEditDisplay"+e.comments.data[o].problemCommentId]},e.comments.vote=function(o,n){isNaN(o)||void 0!==e.userDataShared&&(-1>n&&(n=-1),n>1&&(n=1),n===e.comments.data[o].userVote&&(n=0),t.post("/problem/comment/vote",{problemCommentId:e.comments.data[o].problemCommentId,vote:n}).success(function(t){t===!0&&(-1===e.comments.data[o].userVote?e.comments.data[o].hateCount--:1===e.comments.data[o].userVote&&e.comments.data[o].likeCount--,1===n?e.comments.data[o].likeCount++:-1===n&&e.comments.data[o].hateCount++,e.comments.data[o].userVote=n)}).error(function(e){console.log("error: "+e)}))},e.comments.finalizeComment=function(t,o,n){var r;if(r=null!=o?e["commentTextEditMentionArray"+o]:n,r&&t)for(var a=0;a<r.length;a++){var s=r[a],i=new RegExp("\\b"+s.username+"\\b","");t=t.replace(i,"[[user:"+s.username+"]]")}return t},e.comments.get=function(n){isNaN(n)||(e.comments.currentPage=n,t.post("/problem/comment/count",{problemId:o.problemId}).success(function(t){e.comments.totalPage=Math.ceil(t/10),e.comments.pages=a.getPageArr(e.comments.currentPage,e.comments.totalPage)}).error(function(e){console.log("error: "+e)}),t.post("/problem/comment/get",{problemId:o.problemId,page:e.comments.currentPage}).success(function(t){if(t){if(t)for(var o=0;o<t.length;o++)e.comments.initComment(t[o]);e.comments.data=t}}).error(function(e){console.log("error: "+e)}))},e.comments.initComment=function(t){(void 0===e["commentTextEditMentionArray"+t.problemCommentId]||null===e["commentTextEditMentionArray"+t.problemCommentId])&&(e["commentTextEditMentionArray"+t.problemCommentId]=[]);for(var o=t.comment,n=/\[\[user:([0-9a-zA-Z]+)]]\[([a-zA-Z#0-9]+)]/g,r=n.exec(o);null!=r;){for(var a=!1,s=0;s<e["commentTextEditMentionArray"+t.problemCommentId].length;s++)if(r[1]==e["commentTextEditMentionArray"+t.problemCommentId][s].username){a=!0;break}a||e["commentTextEditMentionArray"+t.problemCommentId].push({username:r[1],color:r[2]}),r=n.exec(o)}t.comment=t.comment.replace(n,"$1"),e["commentTextEditDisplay"+t.problemCommentId]=t.comment},e.comments.getTextEditDisplayModel=function(t){return e["commentTextEditDisplay"+t]},e.comments.add=function(){if(/\S/.test(e.commentTextAddDisplay)){e.isWorking=!0,null!==hoverCard_username&&removeHoverCard(1);var n=jQuery.Event("mouseleave");i(function(){$("#commentTypeahead").siblings(".commentBox").trigger(n),t.post("/problem/comment/add",{problemId:o.problemId,comment:e.comments.finalizeComment(e.commentTextAddDisplay,null,e.commentTextAddMentionArray)}).success(function(t){t&&(e.comments.textAdd="",e.commentTextAddDisplay="",e.commentTextAddMentionArray=[],1===e.comments.currentPage?(e.comments.initComment(t),e.comments.data.unshift(t),e.comments.data.length>10&&e.comments.data.pop()):e.comments.get(1)),e.isWorking=!1}).error(function(t){e.isWorking=!1,console.log("error: "+t)})},100)}},e.bookmarkProblem={isBookmarked:!1},e.bookmarkProblem.check=function(){t.post("/problem/bookmark/check",{problemId:o.problemId}).success(function(t){e.bookmarkProblem.isBookmarked=t}).error(function(e){console.log("error: "+e)})},e.bookmarkProblem.add=function(){t.post("/problem/bookmark/add",{problemId:o.problemId}).success(function(t){t&&(e.bookmarkProblem.isBookmarked=!0)}).error(function(e){console.log("error: "+e)})},e.bookmarkProblem.remove=function(){t.post("/problem/bookmark/remove",{problemId:o.problemId}).success(function(t){t&&(e.bookmarkProblem.isBookmarked=!1)}).error(function(e){console.log("error: "+e)})},e.hintMouseDown=function(){e.problemDetails.showHint=!0},e.hintMouseUp=function(){e.problemDetails.showHint=!1},e.populateProblemDetails=function(){t.post("problem/view/"+o.problemId).success(function(t){e.problemDetails=t,e.problemDetails.showHint=!1;var o=a.getCookie("problemDetailsLocale");void 0===o||"EN"!==o&&"VI"!==o?e.problemDetails.locale="EN":e.problemDetails.locale=o,void 0===e.problemDetails.descriptions.EN||null===e.problemDetails.descriptions.EN.problem||"undefined"===e.problemDetails.descriptions.EN.problem||"null"===e.problemDetails.descriptions.EN.problem||""===e.problemDetails.descriptions.EN.problem?e.problemDetails.localeAvailableEN=!1:e.problemDetails.localeAvailableEN=!0,void 0===e.problemDetails.descriptions.VI||null===e.problemDetails.descriptions.VI.problem||"undefined"===e.problemDetails.descriptions.VI.problem||"null"===e.problemDetails.descriptions.VI.problem||""===e.problemDetails.descriptions.VI.problem?e.problemDetails.localeAvailableVI=!1:e.problemDetails.localeAvailableVI=!0,e.problemDetails["localeAvailable"+e.problemDetails.locale]===!1&&("EN"===e.problemDetails.locale?e.problemDetails.locale="VI":e.problemDetails.locale="EN"),$("head > title").remove(),$("head").append("<title>Problem - "+t.problemId+" - "+t.title+"</title>")}).error(function(e){console.log("error : "+e)})},e.problemDetailChangeLocale=function(t){e.problemDetails.locale=t,a.setCookie("problemDetailsLocale",t,31104e6,"")},e.parseToHTML=function(e){return a.parseToHTML(n,e)},e.populateContestProblemDetails=function(){t.post("problem/view/contest/"+o.problemId,{contestId:o.contestId}).success(function(t){if(e.problemDetails=t,null===t||""===t||void 0===t)r.path("/user/contest/"+o.contestId+"/problem");else{var n=a.getCookie("problemDetailsLocale");void 0===n||"EN"!==n&&"VI"!==n?e.problemDetails.locale="EN":e.problemDetails.locale=n,void 0===e.problemDetails.descriptions.EN.problem||null===e.problemDetails.descriptions.EN.problem||"undefined"===e.problemDetails.descriptions.EN.problem||"null"===e.problemDetails.descriptions.EN.problem||""===e.problemDetails.descriptions.EN.problem?e.problemDetails.localeAvailableEN=!1:e.problemDetails.localeAvailableEN=!0,void 0===e.problemDetails.descriptions.VI.problem||null===e.problemDetails.descriptions.VI.problem||"undefined"===e.problemDetails.descriptions.VI.problem||"null"===e.problemDetails.descriptions.VI.problem||""===e.problemDetails.descriptions.VI.problem?e.problemDetails.localeAvailableVI=!1:e.problemDetails.localeAvailableVI=!0,e.problemDetails["localeAvailable"+e.problemDetails.locale]===!1&&("EN"===e.problemDetails.locale?e.problemDetails.locale="VI":e.problemDetails.locale="EN")}}).error(function(e){console.log("error : "+e)})}}]),$(document).ready(function(){$("body").tooltip({selector:"[data-toggle=tooltip]"}),setInterval(function(){$("blink").each(function(){$(this).css("visibility","hidden"===$(this).css("visibility")?"":"hidden")})},750)});var hoverCardPromise=null,hoverCard_username=null,lastCaretPosition;angular.module("submissionModule",["helperModule","ngAnimate","userModule"]).value("ownSubmitBg","#D4F9C4").directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(t,o,n){var r=e(n.fileModel),a=r.assign;o.bind("change",function(){t.$apply(function(){a(t,o[0].files[0])})})}}}]).controller("SubmissionCtrl",["$scope","$location","$http","$routeParams","Helper",function(e,t,o,n,r){e.addHoverCard_username=addHoverCard_username,e.removeHoverCard=removeHoverCard,e.msg="",e.languages=[],e.selectedLang={},e.problems=[],e.editor=void 0,e.editorRefreshMode=function(){if((void 0===e.editor||null===e.editor)&&$("#editor").length){if(e.editor=ace.edit("editor"),void 0===e.editor)return;e.editor.setShowPrintMargin(!1)}var t;"FPC"===e.selectedLang?t="ace/mode/pascal":e.selectedLang.startsWith("Java")?t="ace/mode/java":"GNU C++"===e.selectedLang||"GNU C"===e.selectedLang||"GNU C++11"===e.selectedLang?t="ace/mode/c_cpp":("Python 2.7"===e.selectedLang||"Python 3.4"===e.selectedLang)&&(t="ace/mode/python"),e.editor.getSession().setMode(t)},e.getLanguages=function(){o.post("/submission/view/language").success(function(t){if(e.languages=t,e.selectedLang=e.languages[0],e.getLangCookie(),void 0===e.editor&&$("#editor").length){if(e.editor=ace.edit("editor"),void 0===e.editor)return;e.editor.setShowPrintMargin(!1),e.editorRefreshMode()}}).error(function(e){console.log("error:"+e)})},e.loadContestLanguage=function(){o.post("/submission/view/language/"+n.contestId).success(function(t){e.languages=t,e.selectedLang=e.languages[0],e.getLangCookie()}).error(function(e){console.log("error"),console.log(e)})},e.loadContestProblem=function(){o.post("/problem/contest/"+n.contestId).success(function(t){e.problems=t,null!==e.problems&&void 0!==e.problems&&""!==e.problems&&e.problems.sort(function(e,t){return e.problemCode<t.problemCode?-1:e.problemCode>t.problemCode?1:0})}).error(function(e){console.log("error"),console.log(e)})},e.setLangCookie=function(e){r.setCookie("selectedLang",e,31536e6,"")},e.getLangCookie=function(){var t=r.getCookie("selectedLang");if(void 0!==t){var o=e.languages.indexOf(t);e.selectedLang=e.languages[o]}},e.submit=function(o){var r="/submission/submit/"+o;if(null===e.selectedLang||""===e.selectedLang||void 0===e.selectedLang)return void(e.msg="Please choose language");if((void 0===e.file||null===e.file)&&(e.solutionText=e.editor.getValue()),!(void 0!==e.file&&null!==e.file||void 0!==e.solutionText&&null!==e.solutionText&&""!==e.solutionText))return void(e.msg="No file chosen and editor is empty");if(e.msg="Uploading...",void 0===e.file||null===e.file){if(e.solutionText.length>65536)return void(e.msg="Failed: maximum character is 65535 characters");var a=new FormData;a.append("language",e.selectedLang),a.append("solution",e.solutionText),void 0!==n.contestId?(r="/submission/submit/contest/text",a.append("contestId",n.contestId),a.append("problemId",n.problemId)):r="/submission/submit/"+o+"/text",$.ajax({type:"POST",url:r,data:a,contentType:!1,processData:!1,cache:!1,success:function(o){e.$apply(function(){e.setLangCookie(e.selectedLang),void 0!==o.string?e.msg=o.string:e.msg=o,"Success"===e.msg&&(void 0!==n.contestId?t.path("/user/contest/"+n.contestId+"/judgestatus"):t.path("/submission"))})},error:function(e){console.log(e)}})}else{if(e.file.size>65536)return void(e.msg="Failed: maximum file size is 64KB");var a=new FormData;a.append("file",e.file),a.append("language",e.selectedLang),void 0!==n.contestId&&(r="/submission/submit/contest",a.append("contestId",n.contestId),a.append("problemId",n.problemId)),$.ajax({type:"POST",url:r,data:a,contentType:!1,processData:!1,cache:!1,success:function(o){e.$apply(function(){e.setLangCookie(e.selectedLang),void 0!==o.string?e.msg=o.string:e.msg=o,"Success"===e.msg&&(void 0!==n.contestId?t.path("/user/contest/"+n.contestId+"/judgestatus"):t.path("/submission"))})},error:function(e){console.log(e),console.log("error : "+e)}})}},e.textSubmit=function(){var o=new FormData;angular.forEach(e.submissionData,function(e,t){this.append(t,e)},o),o.append("contestId",n.contestId),e.msg="Uploading...",$.ajax({type:"POST",url:"/submission/submit/contest/text",data:o,contentType:!1,processData:!1,cache:!1,success:function(o){e.$apply(function(){e.setLangCookie(e.selectedLang),void 0!==o.string?e.msg=o.string:e.msg=o,"Success"===e.msg&&t.path("/user/contest/"+n.contestId+"/judgestatus")})},error:function(e){console.log("error : "+e)}})},e.setMsgOnChange=function(){e.msg=""}}]).controller("SubmissionToolsCtrl",["$scope","$http","$location","$sce","$routeParams","Helper",function(e,t,o,n,r,a){e.submissionIdList="",e.isWorking=!1,e.msg="",e.rejudgeSubmission=function(){e.msg="Processing...",e.isWorking=!0;for(var t=e.submissionIdList.split(","),o=[],n=0;n<t.length;n++){var r=parseInt(t[n]);isNaN(r)||0>=r||-1===o.indexOf(r)&&o.push(r)}var a=new FormData;a.append("submissionId",o),$.ajax({type:"POST",url:"/submission/tools/rejudge",data:a,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.isWorking=!1,void 0!==t.string?e.msg=t.string:e.msg=t})},error:function(t){console.log(t),e.isWorking=!1,console.log("error : "+t)}})}}]).controller("SubmissionViewCtrl",["$scope","$http","$location","$sce","$routeParams","Helper","UserDataSvc","ownSubmitBg","$interval","ServerTimeSvc",function(e,t,o,n,r,a,s,i,c,l){e.addHoverCard_username=addHoverCard_username,e.removeHoverCard=removeHoverCard,e.sterilizeUsername=a.sterilizeUsername,e.currPageNum=1,e.submissions=[],e.submissionData={},e.userDataShared={},e.reconnectSubmissionSocketTimeout=void 0,e.reconnectContestSubmissionSocketTimeout=void 0,e.stompClient=void 0,e.socket=void 0,e.currPageNum=1,e.numOfSubmission=30,e.submissionCount=0,e.totalPage=0,e.pages={},e.hasSpecialPrivilegeInContest=!1,e.contestSubmissionFilter={active:!1},e.currentTime=null,e.$watch(function(){return s.getData()},function(){e.userDataShared=s.getData(),e.checkHasSpecialPrivilegeInContest()}),e.$watch(function(){return l.currentServerTime()},function(){e.currentTime=l.currentServerTime()}),e.$on("$routeChangeStart",function(t,o){null!==e.currentTimePromise&&c.cancel(e.currentTimePromise)}),e.getSubmissionLink=function(e,t){return void 0!==e?"/submission/view/"+t:void 0},e.getContestSubmissionLink=function(e,t,o){return void 0!==e||o===!0?"/user/contest/"+r.contestId+"/submission/"+t:void 0},e.checkHasSpecialPrivilegeInContest=function(){if(void 0!==s.getData()&&null!==r.contestId&&void 0!==r.contestId){var o={contestId:r.contestId};t.post("/announcement/contest/special/check",o).success(function(t){e.hasSpecialPrivilegeInContest=t,e.populateContestSubmission()}).error(function(e){console.log("error"),console.log(e)})}},e.populateSubmission=function(){t.post("/submission/view/").success(function(t){e.submissions=t,void 0!==e.submissions&&null!==e.submissions&&""!==e.submissions&&e.submissions.forEach(function(t){void 0!==e.userDataShared&&t.userId===e.userDataShared.userId&&(t.backgroundColor=i),t.verdictColor=a.getVerdictColor(t.verdict),t.verdictDescription=a.getVerdictDescription(t.verdict)})}).error(function(e){console.log("error : "+e)})},e.prevPage=function(){e.currPageNum>1&&(e.currPageNum--,e.populateContestSubmission())},e.nextPage=function(){e.currPageNum<e.totalPage&&(e.currPageNum++,e.populateContestSubmission())},e.populateFilteredContestSubmission=function(o){o&&(e.currPageNum=1),e.contestSubmissionFilter.active=!0,void 0!==e.userDataShared&&(e.connectContest(),(void 0===e.contestSubmissionFilter.username||null===e.contestSubmissionFilter.username)&&(e.contestSubmissionFilter.username=""),(void 0===e.contestSubmissionFilter.problemName||null==e.contestSubmissionFilter.problemName)&&(e.contestSubmissionFilter.problemName=""),(void 0===e.contestSubmissionFilter.language||null===e.contestSubmissionFilter.language)&&(e.contestSubmissionFilter.language=""),(void 0===e.contestSubmissionFilter.verdict||null===e.contestSubmissionFilter.verdict)&&(e.contestSubmissionFilter.verdict=""),t.post("/submission/view/contest/filter/"+r.contestId+"/"+e.currPageNum,e.contestSubmissionFilter).success(function(t){e.submissions=t,void 0!==e.userDataShared&&null!==e.submissions&&void 0!==e.submissions&&""!==e.submissions&&e.submissions.forEach(function(t){t.userId===e.userDataShared.userId&&(t.backgroundColor=i),t.verdictDescription=a.getVerdictDescription(t.verdict)})}).error(function(e){console.log("error"),console.log(e)}),t.post("/submission/view/contest/count/filter/"+r.contestId,e.contestSubmissionFilter).success(function(t){e.submissionCount=t,e.totalPage=Math.ceil(e.submissionCount/e.numOfSubmission),e.pages=a.getPageArr(e.currPageNum,e.totalPage)}).error(function(e){console.log("error: "),console.log(e)}))},e.populateContestSubmission=function(o){return void 0===o||isNaN(o)||(e.currPageNum=o),e.contestSubmissionFilter.active===!0?void e.populateFilteredContestSubmission():void(void 0!==e.userDataShared&&(e.connectContest(),t.post("/submission/view/contest/"+r.contestId+"/"+e.currPageNum).success(function(t){e.submissions=t,void 0!==e.userDataShared&&null!==e.submissions&&void 0!==e.submissions&&""!==e.submissions&&e.submissions.forEach(function(t){t.userId===e.userDataShared.userId&&(t.backgroundColor=i),t.verdictColor=a.getVerdictColor(t.verdict),t.verdictDescription=a.getVerdictDescription(t.verdict)})}).error(function(e){console.log("error"),console.log(e)}),t.post("/submission/view/contest/count/"+r.contestId).success(function(t){e.submissionCount=t,e.totalPage=Math.ceil(e.submissionCount/e.numOfSubmission),e.pages=a.getPageArr(e.currPageNum,e.totalPage)}).error(function(e){console.log("error: "),console.log(e)})))},e.$on("$routeChangeStart",function(t,o){clearTimeout(e.reconnectSubmissionSocketTimeout),clearTimeout(e.reconnectContestSubmissionSocketTimeout),void 0!==e.stompClient&&e.stompClient.connected&&e.stompClient.disconnect()}),e.connect=function(){e.socket=new SockJS("localhost"===o.host()?"https://localhost:8443/websocket/general/endpoint":"https://jollybeeoj.com/websocket/general/endpoint"),e.stompClient=Stomp.over(e.socket),e.stompClient.debug=null;var t=function(t){void 0!==e.userDataShared&&t.userId===e.userDataShared.userId&&(t.backgroundColor=i),t.verdictColor=a.getVerdictColor(t.verdict),t.verdictDescription=a.getVerdictDescription(t.verdict),e.submissions.unshift(t),e.submissions.length>30&&e.submissions.pop()},n=function(t){for(idx in e.submissions)if(e.submissions[idx].submissionId===t.submissionId){e.submissions[idx].runtime=t.runtime,e.submissions[idx].verdict=t.verdict,e.submissions[idx].memory=t.memory,e.submissions[idx].verdictColor=a.getVerdictColor(t.verdict),e.submissions[idx].verdictDescription=a.getVerdictDescription(e.submissions[idx].verdict);break}};e.stompClient.connect({},function(o){e.stompClient.subscribe("/websocket/subscribe/submission/live",function(o){t(JSON.parse(o.body)),e.$digest();
}),e.stompClient.subscribe("/websocket/subscribe/submission/live/update",function(t){n(JSON.parse(t.body)),e.$digest()})},function(t){e.reconnectSubmissionSocketTimeout=setTimeout(function(){e.connect()},1e4)})},e.connectContest=function(){void 0!==e.stompClient&&e.stompClient.connected||(e.socket=new SockJS("localhost"===o.host()?"https://localhost:8443/websocket/general/endpoint":"https://jollybeeoj.com/websocket/general/endpoint"),e.stompClient=Stomp.over(e.socket),e.stompClient.debug=null,e.stompClient.connect(null,null,function(t){var o="/websocket/subscribe/contest/submission/live/"+r.contestId+(e.hasSpecialPrivilegeInContest===!0?"":"/"+e.userDataShared.userId),n="/websocket/subscribe/contest/submission/live/update/"+r.contestId+(e.hasSpecialPrivilegeInContest===!0?"":"/"+e.userDataShared.userId);e.stompClient.subscribe(o,function(o){if(o=JSON.parse(o.body),o.userId===e.userDataShared.userId&&(o.backgroundColor=i),o.verdictColor=a.getVerdictColor(t.verdict),o.verdictDescription=a.getVerdictDescription(o.verdict),(void 0===e.submissions||null===e.submissions||""===e.submissions)&&(e.submissions=[]),e.contestSubmissionFilter.active===!0){if(void 0!==e.contestSubmissionFilter.username&&null!==e.contestSubmissionFilter.username&&""!==e.contestSubmissionFilter.username&&-1===o.username.indexOf(e.contestSubmissionFilter.username))return;if(void 0!==e.contestSubmissionFilter.problemName&&null!==e.contestSubmissionFilter.problemName&&""!==e.contestSubmissionFilter.problemName&&-1===o.problemName.indexOf(e.contestSubmissionFilter.problemName))return;if(void 0!==e.contestSubmissionFilter.language&&null!==e.contestSubmissionFilter.language&&""!==e.contestSubmissionFilter.language&&-1===o.language.indexOf(e.contestSubmissionFilter.language))return;if(void 0!==e.contestSubmissionFilter.verdict&&null!==e.contestSubmissionFilter.verdict&&""!==e.contestSubmissionFilter.verdict&&-1===o.verdict.indexOf(e.contestSubmissionFilter.verdict))return}1===e.currPageNum&&e.submissions.unshift(o),e.submissions.length>30&&e.submissions.pop(),e.$digest()}),e.stompClient.subscribe(n,function(t){t=JSON.parse(t.body);for(idx in e.submissions)if(e.submissions[idx].submissionId===t.submissionId){e.submissions[idx].runtime=t.runtime,e.submissions[idx].verdict=t.verdict,e.submissions[idx].memory=t.memory,e.submissions[idx].verdictColor=a.getVerdictColor(t.verdict),e.submissions[idx].verdictDescription=a.getVerdictDescription(e.submissions[idx].verdict);break}e.$digest()})},function(t){e.reconnectContestSubmissionSocketTimeout=setTimeout(function(){e.connectContest()},1e4)}))},e.parseToHTML=function(e){return a.parseToHTML(n,e)},e.populateSubmissionDetail=function(){t.post("/submission/view/"+r.submissionId).success(function(t){e.submissionData=t,e.submissionData.verdictColor=a.getVerdictColor(e.submissionData.verdict),e.submissionData.verdictDescription=a.getVerdictDescription(e.submissionData.verdict),setTimeout(function(){Prism.highlightAll()},10)}).error(function(e){console.log("error:"),console.log(e)})},e.populateContestSubmissionDetail=function(){t.post("/submission/view/detail/contest/"+r.submissionId+"/"+r.contestId).success(function(t){e.submissionData=t,e.submissionData.verdictDescription=a.getVerdictDescription(e.submissionData.verdict),setTimeout(function(){Prism.highlightAll()},10)}).error(function(e){console.log("error:"),console.log(e)})},e.contestProblemPath=function(e){return"/user/contest/"+r.contestId+"/problem/"+e}}]),angular.module("userModule",["helperModule","navModule","ui.bootstrap"]).service("UserDataSvc",[function(){this.setNotification=function(e){this.notification=e},this.getNotification=function(){return this.notification},this.setData=function(e){this.userDataShared=e},this.getData=function(){return this.userDataShared}}]).service("ServerTimeSvc",["$timeout","$interval","$http",function(e,t,o){var n=null,r=null,a=function(){o.get("/announcement/get_server_time").success(function(t){n=t,(null===t||""===t||NaN===t)&&e(function(){a()},1e4)}).error(function(t){e(function(){a()},1e4)})};return{init:function(){a(),t(function(){a()},6e5),null===r&&(r=t(function(){NaN!==n&&(n+=1e3)},1e3))},currentServerTime:function(){return n}}}]).filter("powerIsNotAddedIn",function(){return function(e,t,o){var n=t.powerList,r={};if(n.hasOwnProperty(o))for(var a in e)n[o].hasOwnProperty(a)||(r[a]=e[a]);else r=e;return r}}).directive("authoringTestcaseModelR",["$parse",function(e){return{restrict:"A",link:function(t,o,n){var r=e(n.authoringTestcaseModelR),a=r.assign;o.bind("change",function(){t.$apply(function(){a(t,o[0].files[0])}),t.authoring.uploadTestcase()})}}}]).controller("UserCtrl",["$scope","$http","$location","$routeParams","Helper","UserDataSvc","$sce","$q",function(e,t,o,n,r,a,s,i){e.addHoverCard_username=addHoverCard_username,e.removeHoverCard=removeHoverCard,e.Math=window.Math,e.msg="",e.feedbackMsg="",e.loginView="login",e.monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],e.notification={},e.userData={},e.roleData={},e.authoring={data:{},detail:{}},e.mentorship={addExerciseData:{},allSlotCount:0,addGroupData:{},buySlotData:{numberOfSlots:1,duration:1},currentPage:"mentor",editGroupData:{},editSlotData:{},exerciseData:{},groupData:{},groupName:{},mentee:{showMentor:{}},mentor:{submissionStatisticData:[],submissionStatisticChart:[],plagiarism:{plagiarismResultData:{},highestPercentage:{}}},renewSlotData:{duration:1,lockedCount:"...",source:"all slots"},showGroup:{"-1":!0},showSlot:{"-1":!1},slotActiveCount:0,slotPage:1,slotPerPage:20,slotSortColumn:"mentorshipSlotId",slotSortOrder:"ASC"},e.userDataShared={username:"Guest"},e.autocomplete,e.users=[],e.userCount=0,e.rank={rankPerPage:30,currentPage:"rating",currentPageNumber:1},e.badges={data:[],detailIndex:-1},e.roles=[],e.rolePowers={},e.powerList={},e.manageCoin={donateValue:1,currentPage:1,totalPage:1,coin:"..."},e.resetUsername="",e.resetNewPassword="",e.resetConfirmNewPassword="",e.resetToken="",e.resetTokenSent=!1,e.resetRequestMsg="",e.isWorking=!1,e.archiveSubmission={submissionPerPage:5},e.profileSettings={},e.statisticMsg="",e.compareStatisticWithUsername="",e.compareStatisticUsernameList=[],e.submissionStatisticData=void 0,e.submissionStatisticChart=void 0,e.ratingStatisticRawData=void 0,e.ratingStatisticData=void 0,e.ratingStatisticChart=void 0,e.globalChartOptions={animation:{duration:1e3,easing:"out",startup:!0},legend:"none",hAxis:{textPosition:"none"},chartArea:{width:"80%",height:"90%"}},e.waitForFinalEvent=function(){var e={};return function(t,o,n){n||(n="Don't call this twice without a uniqueId"),e[n]&&clearTimeout(e[n]),e[n]=setTimeout(t,o)}}(),e.$watch(function(){return a.getNotification()},function(){e.notification=a.getNotification()}),e.$watch(function(){return a.getData()},function(){e.userDataShared=a.getData()}),e.$watch(function(){return e.compareStatisticUsernameList},function(){e.statisticMsg="",e.refreshSubmissionStatisticChart(),e.refreshRatingStatisticChart()},!0),e.hexToRgb=function(e){if(void 0!==e){var t=parseInt(e.substring(1),16),o=t>>16&255,n=t>>8&255,r=255&t;return o+","+n+","+r}},e.parseToHTML=function(e){return r.parseToHTML(s,e)},e.parseDateReadable=function(t){if(t){var o=new Date(t);return("0"+o.getDate()).slice(-2)+"-"+e.monthNames[o.getMonth()]+"-"+o.getFullYear()+" "+("0"+o.getHours()).slice(-2)+":"+("0"+o.getMinutes()).slice(-2)+":"+("0"+o.getSeconds()).slice(-2)}},$("#authoringData").on("click",".authoringTestcaseUploadBtn",function(){$("#authoringTestcaseUpload").click()}),e.authoring.uploadTestcase=function(){var t=new FormData;return e.testcaseFile.size>10485760?void alert("Maximum file size is 10MB"):(t.append("authoringProblemId",e.authoring.detail.authoringProblemId),t.append("file",e.testcaseFile),void $.ajax({type:"POST",url:"/user/authoring/tc/upload",data:t,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){"Success"!==t?alert(t):e.authoring.get()})},error:function(e){console.log("error"),console.log(e)}}))},e.authoring.get=function(){t.post("/user/authoring/get").success(function(t){if("null"!==t&&null!==t){e.authoring.data.proc=[],e.authoring.data.published=[];for(var o=0;o<t.length;o++)"published"===t[o].status?e.authoring.data.published.push(t[o]):e.authoring.data.proc.push(t[o])}}).error(function(e){console.log(e)})},e.authoring.getDetail=function(o){e.authoring.isWorking=!0,t.post("/user/authoring/get/detail",{authoringProblemId:o}).success(function(t){e.authoring.detail=t,e.authoring.detail.allowedJC===!0?e.authoring.detail.allowedJC="true":e.authoring.detail.allowedJC="false",e.authoring.isWorking=!1}).error(function(e){console.log(e)})},e.authoring.update=function(){var t=new FormData;if(e.authoring.msg="All fields must be filled with correct values",void 0!==e.authoring.detail.title&&null!==e.authoring.detail.title&&void 0!==e.authoring.detail.memoryLimit&&null!==e.authoring.detail.memoryLimit&&void 0!==e.authoring.detail.timeLimit&&null!==e.authoring.detail.timeLimit&&void 0!==e.authoring.detail.difficulty&&null!==e.authoring.detail.difficulty&&void 0!==e.authoring.detail.problemDescription&&null!==e.authoring.detail.problemDescription&&void 0!==e.authoring.detail.inputDescription&&null!==e.authoring.detail.inputDescription&&void 0!==e.authoring.detail.outputDescription&&null!==e.authoring.detail.outputDescription&&void 0!==e.authoring.detail.notes&&null!==e.authoring.detail.notes&&void 0!==e.authoring.detail.allowedJC&&null!==e.authoring.detail.allowedJC&&void 0!==e.authoring.detail.solution&&null!==e.authoring.detail.solution){e.authoring.msg="Processing...",e.authoring.isWorking=!0;for(key in e.authoring.detail)e.authoring.detail.hasOwnProperty(key)&&t.append(key,e.authoring.detail[key]);$.ajax({url:"/user/authoring/update",contentType:!1,processData:!1,cache:!1,method:"POST",data:t,success:function(t){e.$apply(function(){if(e.authoring.msg=t,"Success"===t)for(var o=0;o<e.authoring.data.proc.length;o++)if(e.authoring.data.proc[o].authoringProblemId===e.authoring.detail.authoringProblemId){e.authoring.data.proc[o].title=e.authoring.detail.title,e.authoring.data.proc[o].allowedJC=e.authoring.detail.allowedJC;break}e.authoring.isWorking=!1})},error:function(e){console.log(e)}})}},e.authoring.repropose=function(){var t=new FormData;if(e.authoring.msg="All fields must be filled with correct values",void 0!==e.authoring.detail.title&&null!==e.authoring.detail.title&&void 0!==e.authoring.detail.memoryLimit&&null!==e.authoring.detail.memoryLimit&&void 0!==e.authoring.detail.timeLimit&&null!==e.authoring.detail.timeLimit&&void 0!==e.authoring.detail.difficulty&&null!==e.authoring.detail.difficulty&&void 0!==e.authoring.detail.problemDescription&&null!==e.authoring.detail.problemDescription&&void 0!==e.authoring.detail.inputDescription&&null!==e.authoring.detail.inputDescription&&void 0!==e.authoring.detail.outputDescription&&null!==e.authoring.detail.outputDescription&&void 0!==e.authoring.detail.notes&&null!==e.authoring.detail.notes&&void 0!==e.authoring.detail.allowedJC&&null!==e.authoring.detail.allowedJC&&void 0!==e.authoring.detail.solution&&null!==e.authoring.detail.solution){e.authoring.msg="Processing...",e.authoring.isWorking=!0;for(key in e.authoring.detail)e.authoring.detail.hasOwnProperty(key)&&t.append(key,e.authoring.detail[key]);$.ajax({url:"/user/authoring/repropose",contentType:!1,processData:!1,cache:!1,method:"POST",data:t,success:function(t){e.$apply(function(){e.authoring.msg=t,"Success"===t&&e.authoring.get(),e.authoring.isWorking=!1})},error:function(e){console.log(e)}})}},e.authoring.add=function(){var t=new FormData;if(e.authoring.msg="All fields must be filled with correct values",void 0!==e.authoring.detail.title&&null!==e.authoring.detail.title&&void 0!==e.authoring.detail.memoryLimit&&null!==e.authoring.detail.memoryLimit&&void 0!==e.authoring.detail.timeLimit&&null!==e.authoring.detail.timeLimit&&void 0!==e.authoring.detail.difficulty&&null!==e.authoring.detail.difficulty&&void 0!==e.authoring.detail.problemDescription&&null!==e.authoring.detail.problemDescription&&void 0!==e.authoring.detail.inputDescription&&null!==e.authoring.detail.inputDescription&&void 0!==e.authoring.detail.outputDescription&&null!==e.authoring.detail.outputDescription&&void 0!==e.authoring.detail.notes&&null!==e.authoring.detail.notes&&void 0!==e.authoring.detail.allowedJC&&null!==e.authoring.detail.allowedJC&&void 0!==e.authoring.detail.solution&&null!==e.authoring.detail.solution){e.authoring.msg="Processing...",e.authoring.isWorking=!0;for(key in e.authoring.detail)e.authoring.detail.hasOwnProperty(key)&&t.append(key,e.authoring.detail[key]);$.ajax({url:"/user/authoring/add",contentType:!1,processData:!1,cache:!1,method:"POST",data:t,success:function(t){e.$apply(function(){e.authoring.msg=t,"Success"===t&&e.authoring.get(),e.authoring.isWorking=!1})},error:function(e){console.log(e)}})}},e.authoring.tget=function(){t.post("/user/tools/authoring/get").success(function(t){if(null!==t){e.authoring.data.proc=[],e.authoring.data.approved=[];for(var o=0;o<t.length;o++)"approved"===t[o].status?e.authoring.data.approved.push(t[o]):e.authoring.data.proc.push(t[o])}}).error(function(e){console.log(e)})},e.authoring.approve=function(){var t=new FormData;t.append("authoringProblemId",e.authoring.detail.authoringProblemId),t.append("status","approved"),confirm("Are you sure you want to approve this problem?")&&(e.authoring.msg="Processing...",e.authoring.isWorking=!0,$.ajax({url:"/user/tools/authoring/status",contentType:!1,processData:!1,cache:!1,method:"POST",data:t,success:function(t){e.$apply(function(){e.authoring.msg=t,"Success"===t&&e.authoring.tget(),e.authoring.isWorking=!1})},error:function(e){console.log(e)}}))},e.authoring.reject=function(){if(confirm("Are you sure you want to reject this problem?")){e.authoring.msg="Processing...",e.authoring.isWorking=!0;var t=prompt("Enter reason of rejection:"),o=new FormData;o.append("authoringProblemId",e.authoring.detail.authoringProblemId),o.append("status","rejected"),o.append("message",t),$.ajax({url:"/user/tools/authoring/status",contentType:!1,processData:!1,cache:!1,method:"POST",data:o,success:function(t){e.$apply(function(){e.authoring.msg=t,"Success"===t&&e.authoring.tget(),e.authoring.isWorking=!1})},error:function(e){console.log(e)}})}},e.authoring.publish=function(){if(confirm("Are you sure you want to publish this problem? After this problem is published, all testcases related to this problem will be deleted permanently from database")){e.authoring.msg="Processing...",e.authoring.isWorking=!0;var t=prompt("Where will the problem be published? (example: 'Archive', 'Jolly Challenge #13', etc.)"),o=prompt("Enter the url of published problem:");if(null===t||null===o||""===t||""===o)return;var n=new FormData;n.append("authoringProblemId",e.authoring.detail.authoringProblemId),n.append("publishUrl",o),n.append("publishedIn",t),$.ajax({url:"/user/tools/authoring/publish",contentType:!1,processData:!1,cache:!1,method:"POST",data:n,success:function(t){e.$apply(function(){e.authoring.msg=t,"Success"===t&&e.authoring.tget(),e.authoring.isWorking=!1})},error:function(e){console.log(e)}})}},e.authoring.getSpecific=function(){t.post("/user/tools/authoring/get/username",{username:e.authoring.specificUsername}).success(function(t){e.authoring.data.specific=t}).error(function(e){console.log(e)})},e.manageCoin.generatePageArray=function(){e.manageCoin.totalPage=Math.ceil(e.manageCoin.transactionHistoryCount/10),e.manageCoin.pages=r.getPageArr(e.manageCoin.currentPage,e.manageCoin.totalPage)},e.manageCoin.getUserCoin=function(){t.post("/user/coin").success(function(t){e.manageCoin.coin=t}).error(function(e){console.log("error: "+e)})},e.manageCoin.getUserCoinTransaction=function(o){isNaN(o)||(e.manageCoin.currentPage=o),t.post("/user/coin/transaction/count").success(function(t){e.manageCoin.transactionHistoryCount=t,e.manageCoin.generatePageArray()}).error(function(e){console.log("error: "+e)}),t.post("/user/coin/transaction",{pageNumber:e.manageCoin.currentPage}).success(function(t){e.manageCoin.transactionHistory=t}).error(function(e){console.log("error: "+e)})},e.manageCoin.prevPage=function(){e.manageCoin.currentPage<=1||(e.manageCoin.currentPage--,e.manageCoin.getUserCoinTransaction())},e.manageCoin.nextPage=function(){e.manageCoin.currentPage>=e.manageCoin.totalPage||(e.manageCoin.currentPage++,e.manageCoin.getUserCoinTransaction())},e.badges.claimReward=function(o){e.isWorking=!0,t.post("/user/badge/claim",{badgeId:e.badges.data[o].badgeId}).success(function(t){t?(e.badges.modalMessage="Claim success, please refresh the page to see changes",e.badges.data[o].isClaimed=!0):e.badges.modalMessage="Claim failed.",e.isWorking=!1}).error(function(t){console.log("error: "+t),e.isWorking=!1})},e.getBadges=function(){t.post("/user/view/badges",{userId:e.userData.userId}).success(function(t){t.sort(function(e,t){return e.imageLocation<t.imageLocation?-1:e.imageLocation>t.imageLocation?1:0});for(var o=0;o<t.length;o++)t[o].percentage=Math.floor(100*t[o].currentValue/t[o].maximumValue);e.badges.data=t}).error(function(e){console.log("error: "+e)})},e.mentorship.mentor.plagiarism.viewSubmissionDetails=function(o,n,r,a){t.post("/submission/mentorship/mentor/plagiarism/view/submission",{sub1:o,menteeUserId1:n,sub2:r,menteeUserId2:a}).success(function(t){e.mentorship.mentor.plagiarism.modalSub=t,e.mentorship.mentor.plagiarism.modalSubList=[],e.mentorship.mentor.plagiarism.modalSubList.push(o),e.mentorship.mentor.plagiarism.modalSubList.push(r),e.mentorship.mentor.plagiarism.openModalSubmission=!0,setTimeout(function(){Prism.highlightAll()},10)}).error(function(e){console.log(e)})},e.mentorship.mentor.plagiarism.detectPlagiarism=function(){var t=e.mentorship.mentor.plagiarism.activeMentee,o=[];if(e.mentorship.showGroup[-1]===!0)o.push(-1);else for(var n=0;n<e.mentorship.groupData.length;n++){var r=e.mentorship.groupData[n].mentorshipGroupId;e.mentorship.showGroup[r]===!0&&o.push(r)}var a=new FormData;a.append("mentorshipGroupId",o),a.append("menteeUsername",t),$.ajax({url:"/submission/mentorship/mentor/plagiarism",method:"POST",contentType:!1,processData:!1,cache:!1,data:a,success:function(t){e.$apply(function(){e.mentorship.mentor.plagiarism.highestPercentage={},e.mentorship.mentor.plagiarism.plagiarismResultData={};for(var o in t)if(t.hasOwnProperty(o)){var n=t[o],r={};e.mentorship.mentor.plagiarism.highestPercentage[o]=0;for(var a=0;a<n.length;a++)r[n[a].problemId]=n[a],e.mentorship.mentor.plagiarism.highestPercentage[o]<n[a].similarityPercentage&&(e.mentorship.mentor.plagiarism.highestPercentage[o]=n[a].similarityPercentage);e.mentorship.mentor.plagiarism.plagiarismResultData[o]=r}e.mentorship.mentor.plagiarism.plagiarismResultData=t})},error:function(e){console.log(e)}})},e.mentorship.mentor.plagiarism.waitForFinalEventGetMenteeList=function(){"plagiarism"===e.mentorship.mentor.currentPage&&e.waitForFinalEvent(function(){e.mentorship.mentor.plagiarism.getMenteeList()},750,"get plagiarism mentee list")},e.mentorship.mentor.plagiarism.getMenteeList=function(){var t=[];if(e.mentorship.showGroup[-1]===!0)t.push(-1);else for(var o=0;o<e.mentorship.groupData.length;o++){var n=e.mentorship.groupData[o].mentorshipGroupId;e.mentorship.showGroup[n]===!0&&t.push(n)}var r=new FormData;r.append("mentorshipGroupId",t),$.ajax({url:"/submission/mentorship/mentor/mentee_list",method:"POST",contentType:!1,processData:!1,cache:!1,data:r,success:function(t){e.$apply(function(){""===t||null===t||void 0===t?e.mentorship.mentor.plagiarism.menteeList=[]:(t.sort(function(e,t){return t>e?-1:e>t?1:0}),e.mentorship.mentor.plagiarism.menteeList=t)})},error:function(e){console.log(e)}})},e.mentorship.mentor.waitForFinalEventGetSubmissionStatistic=function(){"statistic"===e.mentorship.mentor.currentPage&&e.waitForFinalEvent(function(){e.mentorship.mentor.getSubmissionStatistic(),e.mentorship.mentor.getDistinctAcceptedProblem(),e.mentorship.mentor.getRatingStatistic()},750,"get submission statistic")},e.mentorship.mentor.refreshSubmissionStatisticChart=function(t){void 0!==google.visualization&&((void 0===e.mentorship.mentor.submissionStatisticChart[t]||null===e.mentorship.mentor.submissionStatisticChart[t]||""===e.mentorship.mentor.submissionStatisticChart[t])&&0!=$("#submissionStatisticChart"+t).length&&(e.mentorship.mentor.submissionStatisticChart[t]=new google.visualization.ColumnChart(document.getElementById("submissionStatisticChart"+t))),void 0!==e.mentorship.mentor.submissionStatisticData[t]&&null!==e.mentorship.mentor.submissionStatisticData[t]&&""!==e.mentorship.mentor.submissionStatisticData[t]&&e.mentorship.mentor.submissionStatisticChart[t].draw(google.visualization.arrayToDataTable(e.mentorship.mentor.submissionStatisticData[t]),e.globalChartOptions))},e.mentorship.mentor.getSubmissionStatistic=function(){for(var t=[],o=0;o<e.mentorship.slotData.length;o++){var n=e.mentorship.slotData[o].mentorshipSlotId;e.mentorship.showSlot[n]===!0&&t.push(n)}var r=new FormData;r.append("mentorshipSlotId",t),$.ajax({url:"/submission/mentorship/mentor/statistic",method:"POST",contentType:!1,processData:!1,cache:!1,data:r,success:function(t){e.$apply(function(){if(null!==t&&""!==t&&void 0!==t){var o=[["Username","Accepted",{role:"style"},"Compile Error",{role:"style"},"Memory Limit Exceeded",{role:"style"},"Run Time Error",{role:"style"},"Submission Error",{role:"style"},"Time Limit Exceeded",{role:"style"},"Wrong Answer",{role:"style"}]],n=1,r=0;for(var a in t)if(t.hasOwnProperty(a)){var s=t[a],i=[];i.push(a);for(var c=0;14>c;c++)1&c?i.push(""):i.push(0);for(var c=0;c<s.length;c++){var l=s[c],u=-1;"Accepted"===l.verdictDisplayName?u=1:"Compile Error"===l.verdictDisplayName?u=3:"Memory Limit Exceeded"===l.verdictDisplayName?u=5:"Run Time Error"===l.verdictDisplayName?u=7:"Submission Error"===l.verdictDisplayName?u=9:"Time Limit Exceeded"===l.verdictDisplayName?u=11:"Wrong Answer"===l.verdictDisplayName&&(u=13),-1!==u&&(i[u]=l.count,i[u+1]="fill-opacity:0.65; color:"+l.verdictColor)}o.push(i),r++,5===r&&(r=0,e.mentorship.mentor.submissionStatisticData[n]=o,document.getElementById("submissionStatisticChart"+n).style.display="block",e.mentorship.mentor.refreshSubmissionStatisticChart(n),o=[["Username","Accepted",{role:"style"},"Compile Error",{role:"style"},"Memory Limit Exceeded",{role:"style"},"Run Time Error",{role:"style"},"Submission Error",{role:"style"},"Time Limit Exceeded",{role:"style"},"Wrong Answer",{role:"style"}]],n++)}0!=r&&(e.mentorship.mentor.submissionStatisticData[n]=o,document.getElementById("submissionStatisticChart"+n).style.display="block",e.mentorship.mentor.refreshSubmissionStatisticChart(n),n++);for(var c=n;4>=c;c++)document.getElementById("submissionStatisticChart"+c).style.display="none"}})},error:function(e){console.log(e)}})},e.mentorship.mentor.loadAllChart=function(){google.load("visualization","1",{packages:["corechart","line"],callback:function(){e.mentorship.mentor.getSubmissionStatistic(),e.mentorship.mentor.getRatingStatistic(),$(window).off("resize"),$(window).resize(function(){e.waitForFinalEvent(function(){for(var t=1;4>=t;t++)e.mentorship.mentor.refreshSubmissionStatisticChart(t);e.refreshRatingStatisticChart()},100,"refresh submission statistic chart")})}})},e.mentorship.mentor.getRatingStatistic=function(){for(var t=[],o=0;o<e.mentorship.slotData.length;o++){var n=e.mentorship.slotData[o].mentorshipSlotId;e.mentorship.showSlot[n]===!0&&t.push(n)}var r=new FormData;r.append("mentorshipSlotId",t),$.ajax({url:"/user/mentorship/mentor/rating",method:"POST",contentType:!1,processData:!1,cache:!1,data:r,success:function(t){null===t||""===t||void 0===t||t.length<=0||e.$apply(function(){e.ratingStatisticRawData={};for(var o=0;o<t.length;o++){var n=t[o];e.ratingStatisticRawData[n[0].username]=n}var r=new google.visualization.DataTable,a={},s=[],i=[];r.addColumn("date","Contest End Time");for(var c in e.ratingStatisticRawData)if(e.ratingStatisticRawData.hasOwnProperty(c))for(var l=e.ratingStatisticRawData[c],u=0;u<l.length;u++)0==u&&(r.addColumn("number",l[u].username),r.addColumn({type:"string",role:"tooltip",p:{html:!0}}),s.push(l[u].username)),void 0===a[l[u].contestEndTime]&&(a[l[u].contestEndTime]={},i.push(l[u].contestEndTime)),a[l[u].contestEndTime][l[u].username]=l[u];i.sort();for(var o=0;o<i.length;o++){var c=i[o],d=[];if(a.hasOwnProperty(c)){var l=a[c];d.push(new Date(parseInt(c)));for(var u=0;u<s.length;u++){var m=s[u];if(void 0!==a[c][m]){var p=a[c][m],g=a[c][m].changes;g>0&&(g="+"+g),d.push(p.newRating);var h="<div style='padding:10px;'><a href='/user/contest/"+p.contestId+"/about' style='color:black; white-space:nowrap; font-weight:bold; text-decoration:none;' target='_blank'>"+p.contestTitle+"<br>"+p.username+": "+p.newRating+" <span style='color:"+(g>0?"green":0>g?"red":"black")+"'>("+g+")</span></a></div>";d.push(h)}else d.push(null),d.push(null)}}r.addRow(d)}e.ratingStatisticData=r,e.refreshRatingStatisticChart()})},error:function(e){console.log(e)}})},e.mentorship.mentor.getDistinctAcceptedProblem=function(){for(var t=[],o=0;o<e.mentorship.slotData.length;o++){var n=e.mentorship.slotData[o].mentorshipSlotId;e.mentorship.showSlot[n]===!0&&t.push(n)}var r=new FormData;r.append("mentorshipSlotId",t),$.ajax({url:"/submission/mentorship/mentor/dacp",method:"POST",contentType:!1,processData:!1,cache:!1,data:r,success:function(t){null!==t&&""!==t&&void 0!==t&&e.$apply(function(){e.mentorship.mentor.dacpUsernameList=[];for(key in t)t.hasOwnProperty(key)&&t[key].sort(function(e,t){return parseInt(e)<parseInt(t)?-1:parseInt(e)>parseInt(t)?1:0}),e.mentorship.mentor.dacpUsernameList.push(key);e.mentorship.mentor.dacpData=t})},error:function(e){console.log(e)}})},e.mentorship.mentor.changePage=function(t){e.mentorship.mentor.currentPage=t},e.mentorship.mentee.getMentor=function(){t.post("/user/mentorship/mentee/mentor/get").success(function(t){e.mentorship.mentee.dataMentor=t}).error(function(e){console.log("error"),console.log(e)})},e.mentorship.mentee.acceptMentor=function(o){e.mentorship.mentee.dataMentor[o].isWorking=!0,t.post("/user/mentorship/mentee/mentor/accept",{mentorshipSlotId:e.mentorship.mentee.dataMentor[o].mentorshipSlotId}).success(function(t){t===!0&&(e.mentorship.mentee.dataMentor[o].isActive=!0,e.mentorship.mentee.showMentor[e.mentorship.mentee.dataMentor[o].mentorshipSlotId]===!0&&e.mentorship.mentee.getExercise()),e.mentorship.mentee.dataMentor[o].isWorking=!0}).error(function(t){console.log("error"),console.log(t),e.mentorship.mentee.dataMentor[o].isWorking=!0})},e.mentorship.mentee.waitForFinalEventGetExercise=function(){e.waitForFinalEvent(function(){e.mentorship.mentee.getExercise()},750,"get mentee exercise")},e.mentorship.mentee.getExercise=function(){var t=new FormData,o=[];if(void 0!==e.mentorship.mentee.dataMentor)for(var n=0;n<e.mentorship.mentee.dataMentor.length;n++){var r=e.mentorship.mentee.dataMentor[n].mentorshipSlotId;e.mentorship.mentee.showMentor[r]===!0&&o.push(r)}t.append("mentorshipSlotId",o),$.ajax({url:"/user/mentorship/mentee/exercise/get",method:"POST",contentType:!1,processData:!1,cache:!1,data:t,success:function(t){e.$apply(function(){e.mentorship.mentee.dataExercise=t})},error:function(e){console.log("error: "+e)}})},e.mentorship.changePage=function(t){e.mentorship.currentPage=t},e.mentorship.generateSlotPageArray=function(){e.mentorship.slotTotalPage=Math.ceil(e.mentorship.slotActiveCount/e.mentorship.slotPerPage),e.mentorship.slotPages=r.getPageArr(e.mentorship.slotPage,e.mentorship.slotTotalPage),e.mentorship.showSlot[-1]=!1},e.mentorship.slotPrevPage=function(){e.mentorship.slotPage>1&&e.mentorship.slotPage--,e.mentorship.getMentorshipSlot()},e.mentorship.slotNextPage=function(){e.mentorship.slotPage<e.mentorship.slotTotalPage&&e.mentorship.slotPage++,e.mentorship.getMentorshipSlot()},e.mentorship.refreshSlotPageArray=function(){if(e.mentorship.showGroup[-1]===!0)e.mentorship.slotActiveCount=e.mentorship.allSlotCount,e.mentorship.generateSlotPageArray();else{e.mentorship.slotActiveCount=0;for(var t=0;t<e.mentorship.groupData.length;t++)e.mentorship.showGroup[e.mentorship.groupData[t].mentorshipGroupId]===!0&&(e.mentorship.slotActiveCount+=e.mentorship.groupData[t].count);e.mentorship.generateSlotPageArray()}},e.mentorship.buySlot=function(){e.mentorship.buySlotData.isWorking=!0;var t=new FormData;t.append("amount",e.mentorship.buySlotData.numberOfSlots),t.append("month",e.mentorship.buySlotData.duration),$.ajax({url:"/user/mentorship/slot/buy",method:"POST",contentType:!1,processData:!1,cache:!1,data:t,success:function(t){e.$apply(function(){"Success"===t&&(t="Success, please refresh the page to view changes."),e.mentorship.buySlotData.msg=t,e.mentorship.buySlotData.isWorking=!1})},error:function(t){console.log("error: "+t),e.$apply(function(){e.mentorship.buySlotData.isWorking=!1})}})},e.mentorship.renewSlot=function(){e.mentorship.renewSlotData.isWorking=!0;var t=new FormData;t.append("month",e.mentorship.renewSlotData.duration);var o=[];if("all slots"===e.mentorship.renewSlotData.source)o.push(-1);else for(var n=0;n<e.mentorship.slotData.length;n++){var r=e.mentorship.slotData[n].mentorshipSlotId;e.mentorship.showSlot[r]===!0&&"Locked"===e.mentorship.slotData[n].status&&o.push(r)}t.append("mentorshipSlotId",o),$.ajax({url:"/user/mentorship/slot/renew",method:"POST",contentType:!1,processData:!1,cache:!1,data:t,success:function(t){e.$apply(function(){"Success"===t&&(t="Success, please refresh the page to view changes."),e.mentorship.renewSlotData.msg=t,e.mentorship.renewSlotData.isWorking=!1})},error:function(t){console.log("error"),console.log(t),e.mentorship.renewSlotData.isWorking=!1}})},e.mentorship.renewSlotData.refreshLockedCount=function(){if("all slots"===e.mentorship.renewSlotData.source)t.post("/user/mentorship/slot/count/locked").success(function(t){e.mentorship.renewSlotData.lockedCount=t}).error(function(e){console.log("error"),console.log(e)});else{e.mentorship.renewSlotData.lockedCount=0;for(var o=0;o<e.mentorship.slotData.length;o++){var n=e.mentorship.slotData[o].mentorshipSlotId;e.mentorship.showSlot[n]===!0&&"Locked"===e.mentorship.slotData[o].status&&e.mentorship.renewSlotData.lockedCount++}}},e.mentorship.waitForFinalEventGetMentorshipExercise=function(){e.waitForFinalEvent(function(){e.mentorship.getMentorshipExercise()},750,"get mentorship exercise")},e.mentorship.getMentorshipExercise=function(){var t=[];if(e.mentorship.showGroup[-1]===!0)t.push(-1);else for(var o=0;o<e.mentorship.groupData.length;o++){var n=e.mentorship.groupData[o].mentorshipGroupId;e.mentorship.showGroup[n]===!0&&t.push(n)}var r=new FormData;r.append("mentorshipGroupId",t),$.ajax({url:"/user/mentorship/exercise/get",method:"POST",contentType:!1,processData:!1,cache:!1,data:r,success:function(t){e.$apply(function(){""!==t&&null!=t&&void 0!==t&&t.sort(function(e,t){return e.problemId<t.problemId?-1:e.problemId>t.problemId?1:0}),e.mentorship.exerciseData=t,e.mentorship.mentor.isExerciseDataAvailable={};for(var o=0;o<t.length;o++)e.mentorship.mentor.isExerciseDataAvailable[t[o].problemId]=!0})},error:function(e){console.log("error"),console.log(e)}})},e.mentorship.addExercise=function(){var t=[];if(e.mentorship.showGroup[-1]===!0)for(var o=0;o<e.mentorship.groupData.length;o++)t.push(e.mentorship.groupData[o].mentorshipGroupId);else for(var o=0;o<e.mentorship.groupData.length;o++){var n=e.mentorship.groupData[o].mentorshipGroupId;e.mentorship.showGroup[n]===!0&&t.push(n)}var r=e.mentorship.addExerciseData.problemId.split(/[ ,]+/),a=new FormData;a.append("mentorshipGroupId",t),a.append("problemId",r),$.ajax({url:"/user/mentorship/exercise/add",method:"POST",contentType:!1,processData:!1,cache:!1,data:a,success:function(t){e.$apply(function(){"Success"===t&&e.mentorship.getMentorshipExercise(),e.mentorship.addExerciseData.msg=t})},error:function(e){console.log("error"),console.log(e)}})},e.mentorship.deleteMentorshipExercise=function(t){
var o=[];if(e.mentorship.showGroup[-1]===!0)o.push(-1);else for(var n=0;n<e.mentorship.groupData.length;n++){var r=e.mentorship.groupData[n].mentorshipGroupId;e.mentorship.showGroup[r]===!0&&o.push(r)}var a=new FormData;a.append("mentorshipGroupId",o),a.append("problemId",e.mentorship.exerciseData[t].problemId),$.ajax({url:"/user/mentorship/exercise/delete",method:"POST",contentType:!1,processData:!1,cache:!1,data:a,success:function(o){e.$apply(function(){"Success"===o&&e.mentorship.exerciseData.splice(t,1)})},error:function(e){console.log("error"),console.log(e)}})},e.mentorship.populateSlotPage=function(t){isNaN(t)||(e.mentorship.slotPage=t,e.mentorship.getMentorshipSlot())},e.mentorship.changeAllShowSlot=function(){for(var t in e.mentorship.showSlot)e.mentorship.showSlot.hasOwnProperty(t)&&(e.mentorship.showSlot[t]=e.mentorship.showSlot[-1])},e.mentorship.changeSlotSort=function(t){e.mentorship.slotSortColumn===t?"ASC"===e.mentorship.slotSortOrder?e.mentorship.slotSortOrder="DESC":e.mentorship.slotSortOrder="ASC":(e.mentorship.slotSortColumn=t,e.mentorship.slotSortOrder="ASC"),e.mentorship.getMentorshipSlot()},e.mentorship.waitForFinalEventGetMentorshipSlot=function(){e.waitForFinalEvent(function(){e.mentorship.getMentorshipSlot()},750,"get mentorship slot")},e.mentorship.getMentorshipSlot=function(){var t=[];for(var o in e.mentorship.showGroup)e.mentorship.showGroup.hasOwnProperty(o)&&e.mentorship.showGroup[o]===!0&&t.push(o);t.sort(function(e,t){return e>t?1:t>e?-1:0});var n=new FormData;n.append("mentorshipGroupId",t),n.append("sortColumn",e.mentorship.slotSortColumn),n.append("sortOrder",e.mentorship.slotSortOrder),n.append("pageNumber",e.mentorship.slotPage),$.ajax({url:"/user/mentorship/slot",method:"POST",contentType:!1,processData:!1,cache:!1,data:n,success:function(t){e.$apply(function(){e.mentorship.slotData=t,e.mentorship.refreshSlotPageArray()})},error:function(e){console.log("error: "+e)}})},e.mentorship.editMentorshipSlot=function(){e.mentorship.editSlotData.isWorking=!0;var o=e.mentorship.editSlotData.mentorshipSlotId,n=e.mentorship.editSlotData.mentorshipGroupId,r=e.mentorship.editSlotData.menteeUsername;t.post("/user/mentorship/slot/edit",{mentorshipSlotId:o,mentorshipGroupId:n,menteeUsername:r}).success(function(t){if(""==t||null==t||void 0===t.mentorshipSlotId||isNaN(t.mentorshipSlotId))e.mentorship.editSlotData.msg="Failed";else{for(var n=0;n<e.mentorship.slotData.length;n++)if(e.mentorship.slotData[n].mentorshipSlotId===o){e.mentorship.slotData[n]=t;break}e.mentorship.editSlotData.msg="Success"}e.mentorship.editSlotData.isWorking=!1}).error(function(t){console.log("error: "+t),e.mentorship.editSlotData.msg="Failed",e.mentorship.editSlotData.isWorking=!1})},e.mentorship.getMentorshipGroup=function(){t.post("/user/mentorship/slot/count").success(function(t){e.mentorship.allSlotCount=t,e.mentorship.slotActiveCount=t,e.mentorship.generateSlotPageArray()}).error(function(e){console.log("error: "+e)}),t.post("/user/mentorship/group").success(function(t){e.mentorship.groupData=t;for(var o=0;o<t.length;o++)e.mentorship.groupName[e.mentorship.groupData[o].mentorshipGroupId]=e.mentorship.groupData[o].name}).error(function(e){console.log("error: "+e)})},e.mentorship.addMentorshipGroup=function(){e.mentorship.addGroupData.name.length>15&&(e.mentorship.addGroupData.msg="Max. 15 characters"),e.mentorship.addGroupData.isWorking=!0,e.mentorship.addGroupData.msg="Processing...",t.post("/user/mentorship/group/add",e.mentorship.addGroupData).success(function(t){null!==t&&t?(e.mentorship.groupData.push({name:e.mentorship.addGroupData.name,mentorshipGroupId:t,count:0}),e.mentorship.groupName[t]=e.mentorship.addGroupData.name,e.mentorship.addGroupData={},e.mentorship.addGroupData.msg="Success"):e.mentorship.addGroupData.msg="Failed",e.mentorship.addGroupData.isWorking=!1}).error(function(t){console.log("error: "+t),e.mentorship.addGroupData.isWorking=!1,e.mentorship.addGroupData.msg="Failed"})},e.mentorship.editMentorshipGroup=function(){e.mentorship.editGroupData.name.length>15&&(e.mentorship.editGroupData.msg="Max. 15 characters"),e.mentorship.editGroupData.isWorking=!0,e.mentorship.editGroupData.msg="Processing...",t.post("/user/mentorship/group/edit",e.mentorship.editGroupData).success(function(t){if(null!==t&&t){for(var o=0;o<e.mentorship.groupData.length;o++)if(e.mentorship.groupData[o].mentorshipGroupId===e.mentorship.editGroupData.mentorshipGroupId){e.mentorship.groupData[o].name=e.mentorship.editGroupData.name,e.mentorship.groupName[e.mentorship.groupData[o].mentorshipGroupId]=e.mentorship.groupData[o].name;break}e.mentorship.editGroupData.msg="Success"}else e.mentorship.editGroupData.msg="Failed";e.mentorship.editGroupData.isWorking=!1}).error(function(t){console.log("error: "+t),e.mentorship.editGroupData.isWorking=!1,e.mentorship.editGroupData.msg="Failed"})},e.mentorship.deleteMentorshipGroup=function(o){t.post("/user/mentorship/group/delete",{mentorshipGroupId:e.mentorship.groupData[o].mentorshipGroupId}).success(function(t){t===!0&&(e.mentorship.groupName[e.mentorship.groupData[o].mentorshipGroupId]=null,e.mentorship.groupData.splice(o,1))}).error(function(e){console.log("error: "+e)})},e.getUserCount=function(o){t.post("/user/count").success(function(t){e.userCount=t,o&&o()})},e.rank.generatePageArray=function(){e.rank.totalPage=Math.ceil(e.userCount/e.rank.rankPerPage),e.rank.pages=r.getPageArr(e.rank.currentPageNumber,e.rank.totalPage)},e.rank.populateData=function(){t.post("/user/rank/"+e.rank.currentPage,{pageNumber:e.rank.currentPageNumber}).success(function(t){e.rank.data=t}).error(function(e){console.log("error: "+e)})},e.rank.prevPageNumber=function(){e.rank.currentPageNumber>1&&e.rank.currentPageNumber--,e.rank.generatePageArray(),e.rank.populateData()},e.rank.nextPageNumber=function(){e.rank.currentPageNumber<e.rank.totalPage&&e.rank.currentPageNumber++,e.rank.generatePageArray(),e.rank.populateData()},e.rank.changePageNumber=function(t){isNaN(t)||(e.rank.currentPageNumber=t,e.rank.generatePageArray(),e.rank.populateData())},e.rank.changePage=function(t){e.rank.currentPage=t,e.rank.populateData()},e.getUserNotification=function(){t.post("/user/notification/get").success(function(t){var o={};if(o.items=t,o.unread=0,o.maxNotificationTime=0,o.viewNotificationTime=r.getCookie("view_notification_time_"+e.userDataShared.userId),isNaN(o.viewNotificationTime)&&(o.viewNotificationTime=-1),null!==t&&void 0!==t&&"null"!==t&&"undefined"!==t&&""!==t&&t.length>0)for(var n=0;n<t.length;n++)o.maxNotificationTime=Math.max(o.maxNotificationTime,t[n].notificationTime),t[n].isRead===!1&&t[n].notificationTime>o.viewNotificationTime&&o.unread++;a.setNotification(o)}).error(function(e){console.log("error:"+e)})},e.markUserNotification=function(o){e.notification.items[o].isRead!==!0&&t.post("/user/notification/mark",{notificationId:e.notification.items[o].notificationId}).success(function(t){e.notification.items[o].isRead=!0,e.notification.unread--}).error(function(e){console.log("error:"+e)})},e.setViewNotificationTime=function(){r.setCookie("view_notification_time_"+e.userDataShared.userId,e.notification.maxNotificationTime,2592e6,""),e.notification.unread=0},e.notificationRedirect=function(e){o.path(e)},e.getAutocompleteUsername=function(e){return t.post("/user/autocomplete",{pattern:e}).then(function(e){return e.data})},e.searchUsername=function(){$("#searchUsernameInput").val().length>=3&&o.path("/user/view/"+$("#searchUsernameInput").val())},$("#searchUsernameInput").keyup(function(t){13===t.keyCode&&e.searchUsername()}),$("#compareStatisticWithUsernameInput").keyup(function(t){13!==t.keyCode||""===$("#compareStatisticWithUsernameInput").val()||e.isWorking||e.$apply(function(){e.addCompareStatisticUsername()})}),e.addCompareStatisticUsername=function(){var o=$("#compareStatisticWithUsernameInput").val();if(""!==o&&void 0!==o&&null!==o){if(o===n.username&&(e.statisticMsg="Username already exists in chart"),void 0===e.submissionStatisticData)return void(e.statisticMsg="No statistic to be compared");if($("#compareStatisticWithUsernameInput").val(""),e.isWorking=!0,e.statisticMsg="",-1===e.compareStatisticUsernameList.indexOf(o)){var r=!1;i.all([t.post("/submission/statistic/user/u/"+o).success(function(t){null!==t&&""!==t&&void 0!==t&&0!==t.length&&(r=!0,e.updateSubmissionStatisticChart(o,t,null))}).error(function(t){console.log("Error: "+t),e.isWorking=!1}),t.post("/user/statistic/rating",{username:o}).success(function(t){null!==t&&""!==t&&void 0!==t&&0!==t.length&&(r=!0,e.updateRatingStatisticChart(o,t,null))}).error(function(e){console.log(e)})]).then(function(){r?e.compareStatisticUsernameList.push(o):e.statisticMsg="Username does not exists or no statistic to be displayed",e.isWorking=!1})}else e.statisticMsg="Username already exists in comparison list",e.isWorking=!1}},e.deleteCompareStatisticUsername=function(t){e.updateSubmissionStatisticChart(null,null,e.compareStatisticUsernameList[t]),e.updateRatingStatisticChart(null,null,e.compareStatisticUsernameList[t]),e.compareStatisticUsernameList.splice(t,1)},e.loadAllCharts=function(){google.load("visualization","1",{packages:["corechart","line"],callback:function(){e.getSubmissionStatistic(),e.getRatingStatistic(),$(window).off("resize"),$(window).resize(function(){e.waitForFinalEvent(function(){e.refreshSubmissionStatisticChart(),e.refreshRatingStatisticChart()},100,"refresh submission statistic chart")})}})},e.getSubmissionStatistic=function(){var o=n.username;t.post("/submission/statistic/user/u/"+o).success(function(t){if(null!==t&&void 0!==t&&""!==t&&t.length){for(var o=[["Verdict",e.userData.username,{role:"style"}]],n=0;n<t.length;n++)o.push([t[n].verdictDisplayName,t[n].count,"fill-opacity:0.65; color:"+t[n].verdictColor]);e.submissionStatisticData=o,e.refreshSubmissionStatisticChart()}}).error(function(e){console.log("error:"+e)})},e.getRatingStatistic=function(){var o=n.username;t.post("/user/statistic/rating",{username:o}).success(function(t){if(null!==t&&void 0!==t&&""!==t&&t.length>0){void 0===e.ratingStatisticRawData&&(e.ratingStatisticRawData={}),e.ratingStatisticRawData[t[0].username]=t;var n=new google.visualization.DataTable;n.addColumn("date","Contest End Time"),n.addColumn("number",o),n.addColumn({type:"string",role:"tooltip",p:{html:!0}});for(var r=[],a=0;a<t.length;a++){var s=t[a],i=s.changes;i>0&&(i="+"+i);var c="<div style='padding:10px;'><a href='/user/contest/"+s.contestId+"/about' style='color:black; white-space:nowrap; font-weight:bold; text-decoration:none;' target='_blank'>"+s.contestTitle+"<br>"+s.username+": "+s.newRating+" <span style='color:"+(i>0?"green":0>i?"red":"black")+"'>("+i+")</span></a></div>";r.push([new Date(s.contestEndTime),s.newRating,c])}n.addRows(r),e.ratingStatisticData=n,e.refreshRatingStatisticChart()}}).error(function(e){console.log(e)})},e.updateSubmissionStatisticChart=function(t,o,n){if(null!==t&&""!==t&&void 0!==t&&null!==o&&""!==o&&void 0!==o){var r=e.submissionStatisticData;if(r instanceof Array){r[0].push(t),r[0].push({role:"style"});for(var a=1;a<r.length;a++){for(var s=!1,i=0;i<o.length;i++)if(r[a][0]===o[i].verdictDisplayName){s=!0,r[a].push(o[i].count),r[a].push(r[a][2]),o.splice(i,1);break}s||(r[a].push(0),r[a].push(r[a][2]))}for(var i=0;i<o.length;i++){var c=[];c.push(o[i].verdictDisplayName);for(var l=0;l<r[0].length-3;l++)l%2==0?c.push(0):c.push("fill-opacity:0.65; color:"+o[i].verdictColor);c.push(o[i].count),c.push("fill-opacity:0.65; color:"+o[i].verdictColor),r.push(c)}}e.submissionStatisticData=r}if(null!==n&&""!==n&&void 0!==n){var r=e.submissionStatisticData;if(r instanceof Array){var u=r[0].indexOf(n);if(-1!==u)for(var a=r.length-1;a>=0;a--){r[a].splice(u,2);for(var s=!0,i=1;i<r[a].length;i+=2)if(0!==r[a][i]){s=!1;break}s&&r.splice(a,1)}}e.submissionStatisticData=r}},e.updateRatingStatisticChart=function(t,o,n){null!==t&&""!==t&&void 0!==t&&null!==o&&""!==o&&void 0!==o&&(void 0===e.ratingStatisticRawData&&(e.ratingStatisticRawData={}),e.ratingStatisticRawData[o[0].username]=o),null!==n&&""!==n&&void 0!==n&&delete e.ratingStatisticRawData[n];var r=new google.visualization.DataTable,a={},s=[],i=[];r.addColumn("date","Contest End Time");for(var c in e.ratingStatisticRawData)if(e.ratingStatisticRawData.hasOwnProperty(c))for(var l=e.ratingStatisticRawData[c],u=0;u<l.length;u++)0==u&&(r.addColumn("number",l[u].username),r.addColumn({type:"string",role:"tooltip",p:{html:!0}}),s.push(l[u].username)),void 0===a[l[u].contestEndTime]&&(a[l[u].contestEndTime]={},i.push(l[u].contestEndTime)),a[l[u].contestEndTime][l[u].username]=l[u];i.sort();for(var d=0;d<i.length;d++){var c=i[d],m=[];if(a.hasOwnProperty(c)){var l=a[c];m.push(new Date(parseInt(c)));for(var u=0;u<s.length;u++){var p=s[u];if(void 0!==a[c][p]){var g=a[c][p],h=a[c][p].changes;h>0&&(h="+"+h),m.push(g.newRating);var f="<div style='padding:10px;'><a href='/user/contest/"+g.contestId+"/about' style='color:black; white-space:nowrap; font-weight:bold; text-decoration:none;' target='_blank'>"+g.contestTitle+"<br>"+g.username+": "+g.newRating+" <span style='color:"+(h>0?"green":0>h?"red":"black")+"'>("+h+")</span></a></div>";m.push(f)}else m.push(null),m.push(null)}}r.addRow(m)}e.ratingStatisticData=r},e.refreshSubmissionStatisticChart=function(){void 0!==google.visualization&&(void 0===e.submissionStatisticChart&&0!=$("#submissionStatisticChart").length&&(e.submissionStatisticChart=new google.visualization.ColumnChart(document.getElementById("submissionStatisticChart"))),void 0!==e.submissionStatisticData&&null!==e.submissionStatisticData&&""!==e.submissionStatisticData&&e.submissionStatisticChart.draw(google.visualization.arrayToDataTable(e.submissionStatisticData),e.globalChartOptions))},e.refreshRatingStatisticChart=function(){if(void 0!==google.visualization&&(void 0===e.ratingStatisticChart&&0!=$("#ratingStatisticChart").length&&(e.ratingStatisticChart=new google.visualization.LineChart(document.getElementById("ratingStatisticChart"))),void 0!==e.ratingStatisticData&&null!==e.ratingStatisticData&&""!==e.ratingStatisticData)){for(var t=[],o=0;o<e.ratingStatisticData.getNumberOfColumns();o++)t.push(r.colorList()[o%r.colorList().length]);e.ratingStatisticChart.draw(e.ratingStatisticData,{colors:t,tooltip:{isHtml:!0},animation:{duration:1e3,easing:"out",startup:!0},chartArea:{width:"70%",height:"80%"},pointSize:5,interpolateNulls:!0})}},e.archiveSubmission.nextPage=function(){e.archiveSubmission.currentPage<e.archiveSubmission.totalPage&&(e.archiveSubmission.currentPage++,e.populateUserArchiveSubmission())},e.archiveSubmission.prevPage=function(){e.archiveSubmission.currentPage>1&&(e.archiveSubmission.currentPage--,e.populateUserArchiveSubmission())},e.populateUserArchiveSubmission=function(o){null===o||void 0===o||isNaN(o)||(e.archiveSubmission.currentPage=o),t.post("/submission/view/user/count/"+e.userData.userId).success(function(t){e.archiveSubmission.count=t,e.archiveSubmission.totalPage=Math.ceil(t/e.archiveSubmission.submissionPerPage),e.archiveSubmission.pages=r.getPageArr(e.archiveSubmission.currentPage,e.archiveSubmission.totalPage)}).error(function(e){console.log("error: "+e)}),void 0===e.archiveSubmission.currentPage&&(e.archiveSubmission.currentPage=1),t.post("/submission/view/user/"+e.archiveSubmission.currentPage+"/"+e.userData.userId).success(function(t){e.archiveSubmission.data=t,void 0!==e.archiveSubmission.data&&null!==e.archiveSubmission.data&&""!==e.archiveSubmission.data&&e.archiveSubmission.data.forEach(function(t){void 0!==e.userDataShared&&t.userId===e.userDataShared.userId&&(t.link="/submission/view/"+t.submissionId,t.backgroundColor="#FFE3B3"),t.verdictColor=r.getVerdictColor(t.verdict),t.verdictDescription=r.getVerdictDescription(t.verdict)})}).error(function(e){console.log("error : "+e)})},e.editProfile=function(){e.isWorking=!0,e.profileSettings.msg="Processing...";var t=new FormData;for(var o in e.profileSettings)if(void 0!==e.profileSettings[o]&&null!==e.profileSettings[o]&&""!==e.profileSettings[o])if("profilePicture"===o){var n=e.profileSettings[o];if(n.size>262144)return e.profileSettings.msg="Failed: maximum profile picture size is 256kb",void(e.isWorking=!1);t.append(o,e.profileSettings[o])}else"oldPassword"===o?t.append(o,CryptoJS.SHA3(e.profileSettings[o])):"newPassword"===o?t.append(o,CryptoJS.SHA3(e.profileSettings[o])):"confirmNewPassword"===o?t.append(o,CryptoJS.SHA3(e.profileSettings[o])):t.append(o,e.profileSettings[o]);t.append("userId",e.userDataShared.userId),$.ajax({type:"POST",url:"/user/edit/profile",data:t,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){void 0!==t.string?e.profileSettings.msg=t.string:e.profileSettings.msg=t,"Success"===e.profileSettings.msg&&(e.profileSettings.msg+=", please refresh the page to see changes"),e.isWorking=!1})},error:function(t){e.profileSettings.msg=t,e.isWorking=!1}})},e.getProfilePicture=function(e){t.get("/user/profile/picture/"+e).success(function(e){console.log(e)})},e.requestResetPasswordToken=function(){if(e.resetRequestMsg="Processing...",e.isWorking=!0,""===$("#g-recaptcha-response").val())return e.resetRequestMsg="Please complete the captcha challenge and wait for it to finish processing.",void(e.isWorking=!1);var t=new FormData;t.append("username",e.resetUsername),t.append("g_recaptcha_response",$("#g-recaptcha-response").val()),$.ajax({type:"POST",url:"/user/reset/password/req",data:t,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.resetRequestMsg=t,"Success"===t&&(e.resetTokenSent=!0),e.isWorking=!1,grecaptcha.reset()})},error:function(t){console.log("error : "+t),e.resetRequestMsg="Error",e.isWorking=!1,grecaptcha.reset()}})},e.tryResetPassword=function(){if(e.msg="Processing...",e.isWorking=!0,e.resetNewPassword===e.resetConfirmNewPassword){var t=new FormData;t.append("username",e.resetUsername),t.append("token",e.resetToken),t.append("newPassword",String(CryptoJS.SHA3(e.resetNewPassword))),$.ajax({type:"POST",url:"/user/reset/password/try",data:t,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.msg=t,e.isWorking=!1})},error:function(t){console.log("error : "+t),e.msg="Error",e.isWorking=!1}})}},e.checkLogin=function(){t.post("/user/checkLoginSession").success(function(t){t&&(e.userData=t,a.setData(e.userData),e.getUserNotification(),-1!==o.path().indexOf("/user/login")&&o.path("/"))}).error(function(e){console.log("Error : "+e)})},e.hasHiddenProblem=function(){t.post("/problem/check/hidden").success(function(t){e.userDataShared&&(e.userDataShared.hasPower=e.userDataShared.hasPower||t)}).error(function(e){console.log("error"),console.log(e)})},e.login=function(){if(angular.isDefined(e.userData.username)===!1||0===e.userData.username.length||angular.isDefined(e.userData.password)===!1||0===e.userData.password.length)e.msg="All fields must be filled";else{var t=CryptoJS.SHA3(e.userData.password),o=new FormData;o.append("username",e.userData.username),o.append("password",String(t)),e.msg="Processing request",$.ajax({type:"POST",url:"/user/login",data:o,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){t===!0?e.checkLogin():t===!1?e.msg="Wrong username or password":e.checkLogin()})},error:function(e){console.log("Error:"+e)}})}},e.register=function(){if(angular.isDefined(e.userData.username)===!1||0===e.userData.username.length||angular.isDefined(e.userData.password)===!1||0===e.userData.password.length||angular.isDefined(e.userData.email)===!1||0===e.userData.email.length)e.msg="All fields must be filled";else{var t=CryptoJS.SHA3(e.userData.password);if(e.msg="Processing request",e.isWorking=!0,""===$("#g-recaptcha-response").val())return e.msg="Please complete the captcha challenge and wait for it to finish processing.",void(e.isWorking=!1);var o=new FormData;o.append("username",e.userData.username),o.append("password",t),o.append("email",e.userData.email),o.append("name",e.userData.name),o.append("g_recaptcha_response",$("#g-recaptcha-response").val()),$.ajax({type:"POST",url:"/user/register",data:o,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.msg=t,e.isWorking=!1,grecaptcha.reset()})},error:function(t){console.log("error : "+t),e.isWorking=!1,grecaptcha.reset()}})}},e.logout=function(){t.post("/user/logout").success(function(){a.setData(void 0),o.path("/user/login")}).error(function(e){console.log("error : "+e)})},e.sendFeedback=function(){e.isWorking=!0,$.ajax({url:"/user/feedback",method:"POST",data:{feedback:e.feedbackMsg},success:function(t){e.$apply(function(){e.msg=t,e.isWorking=!1})},error:function(t){e.$apply(function(){e.isWorking=!1,console.log("error: "+t)})}})},e.toCamelCase=function(e){return r.toCamelCase(e)},e.clearMsgAndToggleFlip=function(){e.msg="","login"===e.loginView?e.loginView="register":e.loginView="login"},e.getUserDataById=function(){t.post("/user/view/"+n.username).success(function(t){(null===t||void 0===t||""===t)&&o.path("/"),e.userData=t,e.profileSettings.email=e.userData.email,e.profileSettings.name=e.userData.name,e.populateUserArchiveSubmission()}).error(function(e){console.log("error"),console.log(e)})}}]).controller("UserToolsCtrl",["$scope","$http","Helper","$sce",function(e,t,o,n){e.isWorking=!1,e.userData=void 0,e.registeredUserData=[],e.realRegisteredUserData=[],e.registeredUserDataPlainP={},e.roleData={},e.users=[],e.roles=[],e.rolePowers={},e.powerList={},e.inputtedUsers=[],e.msgRegister="",e.msgUpdate="",e.autocomplete={},e.manageCoin={currentPage:1,totalPage:1,valueAddCoin:0},e.parseToHTML=function(e){return o.parseToHTML(n,e)},$("#usernameManageCoin").keyup(function(t){13===t.keyCode&&(e.manageCoin.getUserCoin(),e.manageCoin.getUserCoinTransaction())}),e.manageCoin.generatePageArray=function(){e.manageCoin.totalPage=Math.ceil(e.manageCoin.transactionHistoryCount/10),e.manageCoin.pages=o.getPageArr(e.manageCoin.currentPage,e.manageCoin.totalPage)},e.manageCoin.getUserCoin=function(){t.post("/user/tools/coin",{reqUsername:e.manageCoin.currentUsername}).success(function(t){e.manageCoin.coin=t,e.manageCoin.coinUsername=e.manageCoin.currentUsername}).error(function(e){console.log("error: "+e)})},e.manageCoin.getUserCoinTransaction=function(o){isNaN(o)||(e.manageCoin.currentPage=o),t.post("/user/tools/coin/transaction/count",{reqUsername:e.manageCoin.currentUsername}).success(function(t){e.manageCoin.transactionHistoryCount=t,e.manageCoin.generatePageArray()}).error(function(e){console.log("error: "+e)}),t.post("/user/tools/coin/transaction",{reqUsername:e.manageCoin.currentUsername,pageNumber:e.manageCoin.currentPage}).success(function(t){e.manageCoin.transactionHistory=t}).error(function(e){console.log("error: "+e)})},e.manageCoin.prevPage=function(){e.manageCoin.currentPage<=1||(e.manageCoin.currentPage--,e.manageCoin.getUserCoinTransaction())},e.manageCoin.nextPage=function(){e.manageCoin.currentPage>=e.manageCoin.totalPage||(e.manageCoin.currentPage++,e.manageCoin.getUserCoinTransaction())},e.manageCoin.addUserCoin=function(){if(isNaN(e.manageCoin.valueAddCoin))return void(e.manageCoin.msg="Invalid coin value");if(void 0===e.manageCoin.currentUsername)return void(e.manageCoin.msg="Username is undefined");if(e.manageCoin.isWorking=!0,confirm("Are you sure you want to add "+e.manageCoin.valueAddCoin+" coins for user ["+e.manageCoin.currentUsername+"]? This action can't be undone")){var t=new FormData;t.append("usernameToBeIssued",e.manageCoin.currentUsername),t.append("amountIssued",e.manageCoin.valueAddCoin),t.append("description",e.manageCoin.valueDescription),$.ajax({type:"POST",url:"/user/tools/coin/add",data:t,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.manageCoin.isWorking=!1,e.manageCoin.msg=t,"Success"===t&&(e.manageCoin.getUserCoin(),e.manageCoin.getUserCoinTransaction())})},error:function(t){e.manageCoin.isWorking=!1,e.manageCoin.msg=t}})}else e.manageCoin.isWorking=!1},e.loadAuthorizedContests=function(){t.post("/announcement/tools/contest/user/special_privilege").success(function(t){t.sort(function(e,t){return e.contestId<t.contestId?1:e.contestId>t.contestId?-1:0}),e.contests=t}).error(function(e){console.log("error"),console.log(e)})},e.viewRegisteredUser=function(){null!==e.userData.contestId&&void 0!==e.userData.contestId&&""!==e.userData.contestId&&t.post("/user/tools/contest/view/batch",{contestId:e.userData.contestId}).success(function(t){null==t&&(t=[]);for(var o=0;o<t.length;o++)t[o].username=t[o].username.substring(t[o].username.indexOf("]")+1);e.realRegisteredUserData=$.extend(!0,[],t),e.registeredUserData=$.extend(!0,[],t)}).error(function(e){console.log("Error: "+e)})},e.deleteBatchCreatedUser=function(){if(confirm("Are you sure you want to delete user '"+e.userData.username+"'?")){e.isWorking=!0,e.msgUpdate="Processing...";var t=new FormData;angular.forEach(e.userData,function(e,t){this.append(t,e)},t),$.ajax({type:"POST",url:"/user/tools/contest/delete/batch",data:t,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){if(e.msgUpdate=t,"Success"===t)for(var o=0;o<e.registeredUserData.length;o++)if(e.userData.userId===e.registeredUserData[o].userId){e.registeredUserData.splice(o,1),e.realRegisteredUserData.splice(o,1);break}e.isWorking=!1})},error:function(t){console.log("Error: "+t),e.isWorking=!1}})}},e.registerBatchUser=function(){e.isWorking=!0,e.msgRegister="Processing...",e.userData.username=[],e.userData.name=[],e.userData.description=[],e.userData.password=[],e.userData.plainPassword=[];var t=e.userData.registerText.split("\n");if(null!==t&&void 0!==t&&0!==t.length){for(var n=0;n<t.length;n++)if(0!==t[n].length){var r=t[n].split(",");if(1===r.length)e.userData.username.push(r[0].replace(/\s/g,"")),e.userData.name.push(" "),e.userData.description.push(" "),e.userData.plainPassword.push(o.generateRandomString("abcdefghijklmnopqrstuvwxyz",7));else if(2===r.length)e.userData.username.push(r[0].replace(/\s/g,"")),e.userData.name.push(r[1]),e.userData.description.push(" "),e.userData.plainPassword.push(o.generateRandomString("abcdefghijklmnopqrstuvwxyz",7));else if(3===r.length)e.userData.username.push(r[0].replace(/\s/g,"")),e.userData.name.push(r[1]),e.userData.description.push(r[2]),e.userData.plainPassword.push(o.generateRandomString("abcdefghijklmnopqrstuvwxyz",7));else{if(4!==r.length)return e.msgRegister="Too many data on line : "+(n+1),void(e.isWorking=!1);e.userData.username.push(r[0].replace(/\s/g,"")),e.userData.name.push(r[1]),e.userData.description.push(r[2]),e.userData.plainPassword.push(r[3].replace(/\s/g,""))}}for(var n=0;n<e.userData.plainPassword.length;n++){""===e.userData.plainPassword[n]&&(e.userData.plainPassword[n]=o.generateRandomString("abcdefghijklmnopqrstuvwxyz",7));var a=CryptoJS.SHA3(e.userData.plainPassword[n]);e.userData.password.push(String(a)),e.registeredUserDataPlainP[e.userData.username[n]]=e.userData.plainPassword[n]}if(null===e.userData.contestId||void 0===e.userData.contestId||""===e.userData.contestId)return e.msgRegister="Failed: No contest chosen",void(e.isWorking=!1);var s=new FormData;angular.forEach(e.userData,function(e,t){this.append(t,e)},s),$.ajax({type:"POST",url:"/user/tools/contest/register/batch",data:s,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.msgRegister=t,e.isWorking=!1,"Success"===t&&e.viewRegisteredUser()})},error:function(t){e.isWorking=!1,e.msgRegister="Error: "+t+". Please refresh and redo the registration."}})}},e.updateBatchUser=function(){e.isWorking=!0,e.msgUpdate="Processing...",e.userData.userId=[],e.userData.username=[],e.userData.name=[],e.userData.description=[],e.userData.plainPassword=[],e.userData.password=[];for(var t=0;t<e.registeredUserData.length;t++)e.registeredUserData[t]!==e.realRegisteredUserData[t]&&(e.userData.userId.push(e.registeredUserData[t].userId),e.userData.username.push(e.registeredUserData[t].username.replace(/\s/g,"")),""===e.registeredUserData[t].name||void 0===e.registeredUserData[t].name||null===e.registeredUserData[t].name?e.userData.name.push(" "):e.userData.name.push(e.registeredUserData[t].name),""===e.registeredUserData[t].description||void 0===e.registeredUserData[t].description||null===e.registeredUserData[t].description?e.userData.description.push(" "):e.userData.description.push(e.registeredUserData[t].description),""===e.registeredUserData[t].plainPassword||null===e.registeredUserData[t].plainPassword||void 0===e.registeredUserData[t].plainPassword?e.userData.plainPassword.push(""):e.userData.plainPassword.push(e.registeredUserData[t].plainPassword.replace(/\s/g,"")));for(var t=0;t<e.userData.plainPassword.length;t++)if(""===e.userData.plainPassword[t]||void 0===e.userData.plainPassword[t]||null===e.userData.plainPassword[t])e.userData.password.push("");else{var o=CryptoJS.SHA3(e.userData.plainPassword[t]);e.userData.password.push(String(o)),e.registeredUserDataPlainP[e.userData.username[t]]=e.userData.plainPassword[t]}if(null===e.userData.contestId||void 0===e.userData.contestId||""===e.userData.contestId)return e.msgUpdate="Failed: No contest chosen",void(e.isWorking=!1);var n=new FormData;angular.forEach(e.userData,function(e,t){this.append(t,e)},n),$.ajax({type:"POST",url:"/user/tools/contest/update/batch",data:n,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.msgUpdate=t,"Success"===t&&(e.realRegisteredUserData=$.extend(!0,[],e.registeredUserData)),e.isWorking=!1})},error:function(t){e.isWorking=!1,e.msgUpdate="Error: "+t+". The changes might not be saved, to make sure the database has been updated with the last user data, please refresh and redo your last update."}})},e.getAutocompleteUsername=function(e){return t.post("/user/autocomplete",{pattern:e}).then(function(e){return e.data})},e.loadUserWithSpecificRole=function(o){return 1==o?void(e.users[o]=[]):void t.post("/user/tools/data/role/username",{roleId:o}).success(function(t){e.users[o]=t}).error(function(e){console.log("error: "+e)})},e.deleteUserFromRoleList=function(t,o){e.users[t].splice(o,1)},e.addUserToRoleList=function(t,o){""!==e.autocomplete[t]&&13===o.keyCode&&(-1===$.inArray(e.autocomplete[t],e.users[t])&&e.users[t].push(e.autocomplete[t]),e.autocomplete[t]="")},e.changeUserRole=function(){for(var t=new FormData,o=[],n=[],r=0;r<e.roles.length;r++)for(var a=e.roles[r].roleId,s=0;s<e.users[a].length;s++)n.push(a),o.push(e.users[a][s]);t.append("username",o),t.append("roleId",n),e.isWorking=!0,$.ajax({type:"POST",url:"/user/tools/change_role",data:t,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.msg=t,e.isWorking=!1})},error:function(t){e.isWorking=!1,console.log("error : "+t)}})},e.loadRoles=function(){t.post("/user/tools/data/role").success(function(t){e.roles=t}).error(function(e){console.log("error"),console.log(e)})},e.loadRolePowerByRoleId=function(o){t.post("/user/tools/data/power_role",{roleId:o}).success(function(t){e.powerList=t}).error(function(e){console.log("error"),console.log(e)})},e.loadAvailableRolePower=function(){t.post("/user/tools/data/power").success(function(t){e.rolePowers=t}).error(function(e){console.log("error"),console.log(e)})},e.isEmptyObject=function(e){return o.isEmptyObject(e)},e.moveRolePowerToList=function(t,o,n){e.powerList.hasOwnProperty(t)||(e.powerList[t]={}),e.powerList[t][o]=n},e.deleteRolePowerFromList=function(t,o,n){delete e.powerList[t][o],e.isEmptyObject(e.powerList[t])&&delete e.powerList[t]},e.createNewRole=function(){e.isWorking=!0,e.roleData.powerIdList=[],angular.forEach(e.powerList,function(t,o){angular.forEach(t,function(e,t){this.push(t)},e.roleData.powerIdList)});var t=new FormData;angular.forEach(e.roleData,function(e,t){this.append(t,e)},t),$.ajax({type:"POST",url:"/user/tools/create_role",data:t,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.msg=t,e.isWorking=!1})},error:function(t){e.isWorking=!1,console.log("error : "+t)}})},e.changeRolePower=function(){
e.roleData.powerIdList=[],e.isWorking=!0,angular.forEach(e.powerList,function(t,o){angular.forEach(t,function(e,t){this.push(t)},e.roleData.powerIdList)});var t=new FormData;angular.forEach(e.roleData,function(e,t){this.append(t,e)},t),$.ajax({type:"POST",url:"/user/tools/edit_role",data:t,contentType:!1,processData:!1,cache:!1,success:function(t){e.$apply(function(){e.msg=t,e.isWorking=!1})},error:function(t){e.isWorking=!1,console.log("error : "+t)}})}}]);